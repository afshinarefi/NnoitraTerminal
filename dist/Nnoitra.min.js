(()=>{var e;function t(t){if(t=r.i?.[t]||t,!e)try{throw new Error}catch(i){var s=(""+i.stack).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/[^)\n]+/g);if(!s)return n+t;e=s[0]}return new URL(n+t,e).toString()}var s=globalThis,n="./",i={},a={},r=s.parcelRequire166b;null==r&&((r=function(e){if(e in i)return i[e].exports;if(e in a){var t=a[e];delete a[e];var s={id:e,exports:{}};return i[e]=s,t.call(s.exports,s,s.exports),s.exports}var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}).register=function(e,t){a[e]=t},s.parcelRequire166b=r);var o;r.register;o={H44nx:"motd.6d76bb23.txt",ccCIq:"version.a3fd00c7.txt",euAS4:"UbuntuMono-R.54fdcd79.ttf","4acmQ":"UbuntuMono-B.1f21d913.ttf",jRB9m:"UbuntuMono-RI.0df7809e.ttf","6rugH":"UbuntuMono-BI.2127d1cf.ttf"},Object.assign(r.i??={},o);const l=new Map([["EventBus",!0],["EnvironmentService",!0],["AccountingService",!0],["CommandService",!0],["FilesystemService",!0],["HistoryService",!0],["HintService",!0],["InputService",!0],["TerminalService",!0],["ThemeService",!0],["FaviconService",!0],["LocalStorageService",!0],["AutocompleteService",!0],["TerminalPrompt",!1],["TerminalSymbol",!1],["HintBox",!1],["Terminal",!1],["CommandBlock",!1],["login",!1],["logout",!1],["ls",!1],["cat",!1],["env",!0],["history",!1],["history",!0],["cd",!0],["view",!0]]),c=()=>{},h=new Map;function d(e){if(h.has(e))return h.get(e);const t=l.get(e)||!1,s={log:t?console.log.bind(console,`[${e}]`):c,warn:t?console.warn.bind(console,`[${e}]`):c,error:t?console.error.bind(console,`[${e}]`):c};return h.set(e,s),s}const u=d("EventBus");class m{#e=new Map;#t=new Map;constructor(){u.log("Initializing...")}listen(e,t,s="anonymous"){this.#e.has(e)||this.#e.set(e,[]),this.#e.get(e).push({callback:t,name:s})}dispatch(e,t){u.log(`Dispatching event "${e}" with payload: ${JSON.stringify(t)}`),this.#e.has(e)&&Promise.resolve().then(async()=>{const s=this.#e.get(e);s&&s.forEach(s=>{u.log(`Dispatching event "${e}" to listener "${s.name}"`),Promise.resolve().then(()=>s.callback(t))})})}request(e,t={},s=6e3){const n=`${e}-${Date.now()}-${Math.random()}`;return new Promise((i,a)=>{this.#t.set(n,{resolve:i,reject:a});let r=null;s>0&&(r=setTimeout(()=>{this.#t.has(n)&&(this.#t.get(n).reject(new Error(`Request timed out for event "${e} with payload: ${JSON.stringify(t)}"`)),this.#t.delete(n))},s));const o={...t,respond:t=>!!this.#t.has(n)&&(r&&clearTimeout(r),u.log(`Response received for event "${e}": ${JSON.stringify(t)}`),this.#t.get(n).resolve(t),this.#t.delete(n),!0)};this.dispatch(e,o)})}}const g={GET_ALL_CATEGORIZED_VARS_REQUEST:"get-all-categorized-vars-request",VAR_EXPORT_REQUEST:"variable-export-request",VAR_GET_LOCAL_REQUEST:"variable-get-local-request",VAR_GET_SYSTEM_REQUEST:"variable-get-system-request",VAR_GET_TEMP_REQUEST:"variable-get-temp-request",VAR_GET_USERSPACE_REQUEST:"variable-get-userspace-request",VAR_SET_LOCAL_REQUEST:"variable-set-local-request",VAR_SET_SYSTEM_REQUEST:"variable-set-system-request",VAR_SET_TEMP_REQUEST:"variable-set-temp-request",VAR_SET_USERSPACE_REQUEST:"variable-set-userspace-request",VAR_DEL_LOCAL_REQUEST:"variable-delete-local-request",VAR_DEL_SYSTEM_REQUEST:"variable-delete-system-request",VAR_DEL_TEMP_REQUEST:"variable-delete-temp-request",VAR_DEL_USERSPACE_REQUEST:"variable-delete-userspace-request",LOAD_LOCAL_VAR:"load-local-variable",RESET_LOCAL_VAR:"reset-local-variable",SAVE_LOCAL_VAR:"save-local-variable",DELETE_LOCAL_VAR:"delete-local-variable",VAR_UPDATE_DEFAULT_REQUEST:"variable-update-default-request",USER_CHANGED_BROADCAST:"user-changed-broadcast",LOGIN_REQUEST:"login-request",LOGOUT_REQUEST:"logout-request",PASSWORD_CHANGE_REQUEST:"password-change-request",ADD_USER_REQUEST:"add-user-request",IS_LOGGED_IN_REQUEST:"is-logged-in-request",VAR_SAVE_REMOTE_REQUEST:"variable-save-remote-request",VAR_LOAD_REMOTE_REQUEST:"variable-load-remote-request",VAR_DEL_REMOTE_REQUEST:"variable-delete-remote-request",HISTORY_PREVIOUS_REQUEST:"history-previous-request",HISTORY_NEXT_REQUEST:"history-next-request",HISTORY_INDEXED_RESPONSE:"history-indexed-response",HISTORY_LOAD_REQUEST:"history-load-request",HISTORY_GET_ALL_REQUEST:"history-get-all-request",COMMAND_PERSIST_REQUEST:"command-persist-request",COMMAND_EXECUTE_BROADCAST:"command-execute-broadcast",COMMAND_EXECUTION_FINISHED_BROADCAST:"command-execution-finished-broadcast",AUTOCOMPLETE_REQUEST:"autocomplete-request",AUTOCOMPLETE_BROADCAST:"autocomplete-broadcast",GET_AUTOCOMPLETE_SUGGESTIONS_REQUEST:"get-autocomplete-suggestions-request",GET_ALIASES_REQUEST:"get-aliases-request",SET_ALIASES_REQUEST:"set-aliases-request",GET_COMMAND_LIST_REQUEST:"get-command-list-request",GET_COMMAND_META_REQUEST:"get-command-meta-request",INPUT_REQUEST:"input-request",CLEAR_SCREEN_REQUEST:"clear-screen-request",THEME_CHANGED_BROADCAST:"theme-changed-broadcast",UI_SCROLL_TO_BOTTOM_REQUEST:"ui-scroll-to-bottom-request",SET_THEME_REQUEST:"set-theme-request",GET_VALID_THEMES_REQUEST:"get-valid-themes-request",MEDIA_REQUEST:"media-request",FS_CHANGE_DIRECTORY_REQUEST:"fs-change-directory-request",FS_IS_DIR_REQUEST:"fs-is-directory-request",FS_GET_DIRECTORY_CONTENTS_REQUEST:"fs-get-directory-contents-request",FS_GET_FILE_CONTENTS_REQUEST:"fs-get-file-contents-request",FS_GET_PUBLIC_URL_REQUEST:"fs-get-public-url-request",FS_RESOLVE_PATH_REQUEST:"fs-resolve-path-request",STORAGE_API_REQUEST:"storage-api-request"};class p{#s;#n;constructor(e){if(!e)throw new Error("BaseService requires an eventBus.");this.#s=e,this.#n=d(this.constructor.name),this.log.log("Initializing...")}static create(e,t={}){const s=new this(e,t);return s.#i(),s}start(){}get log(){return this.#n}dispatch(e,t={}){this.#s.dispatch(e,t)}request(e,t,s=0){return this.#s.request(e,t,s)}get eventHandlers(){return{}}#i(){const e=this.eventHandlers;for(const[t,s]of Object.entries(e))this.#s.listen(t,s,this.constructor.name)}}const E={GET_NODE:"getNode",SET_NODE:"setNode",DELETE_NODE:"deleteNode",LIST_KEYS_WITH_PREFIX:"listKeysWithPrefix",LOCK_NODE:"lockNode",UNLOCK_NODE:"unlockNode"},S="ENV",y="SYSTEM",T="USERSPACE";class v extends p{#a=new Map;constructor(e){super(e),this.log.log("Initializing...")}get eventHandlers(){return{[g.GET_ALL_CATEGORIZED_VARS_REQUEST]:this.#r.bind(this),[g.USER_CHANGED_BROADCAST]:this.#o.bind(this),[g.VAR_GET_LOCAL_REQUEST]:this.#l.bind(this),[g.VAR_GET_SYSTEM_REQUEST]:this.#c.bind(this),[g.VAR_GET_TEMP_REQUEST]:this.#h.bind(this),[g.VAR_GET_USERSPACE_REQUEST]:this.#d.bind(this),[g.VAR_SET_LOCAL_REQUEST]:this.#u.bind(this),[g.VAR_SET_SYSTEM_REQUEST]:this.#m.bind(this),[g.VAR_SET_TEMP_REQUEST]:this.#g.bind(this),[g.VAR_SET_USERSPACE_REQUEST]:this.#p.bind(this),[g.VAR_DEL_LOCAL_REQUEST]:this.#E.bind(this),[g.VAR_DEL_SYSTEM_REQUEST]:this.#S.bind(this),[g.VAR_DEL_TEMP_REQUEST]:this.#y.bind(this),[g.VAR_DEL_USERSPACE_REQUEST]:this.#T.bind(this)}}start(){}async#h({key:e,respond:t}){const s=e.toUpperCase();let n=this.#a.get(s);if(void 0===n){this.log.log(`Temp variable "${s}" is undefined, requesting its default value.`);n=(await this.request(g.VAR_UPDATE_DEFAULT_REQUEST,{key:s})).value,void 0!==n&&this.#v(s,n)}t({value:n})}async#l({key:e,respond:t}){const s=e.toUpperCase(),n=`${S}_${s}`,{lockId:i}=await this.#w("LOCAL",E.LOCK_NODE,{key:n});try{const e=await this.#w("LOCAL",E.GET_NODE,{key:n,lockId:i});let a=e?e.content:void 0;if(void 0===a){this.log.log(`Local variable "${s}" is undefined, requesting its default value.`);a=(await this.request(g.VAR_UPDATE_DEFAULT_REQUEST,{key:s})).value,void 0!==a&&await this.#f(s,a,i)}t({value:a})}finally{await this.#w("LOCAL",E.UNLOCK_NODE,{key:n,lockId:i})}}async#d({key:e,respond:t}){return this.#R({key:e,respond:t},T)}async#c({key:e,respond:t}){return this.#R({key:e,respond:t},y)}async#R({key:e,respond:t},s){const n=e.toUpperCase();let i;const{variables:a}=await this.request(g.VAR_LOAD_REMOTE_REQUEST,{key:n,category:s});if(i=a?a[n]:void 0,void 0===i){this.log.log(`Remote/Userspace variable "${n}" is undefined, requesting its default value.`);i=(await this.request(g.VAR_UPDATE_DEFAULT_REQUEST,{key:n})).value,void 0!==i&&this.#_(n,i,s)}t({value:i})}#g({key:e,value:t}){this.#v(e.toUpperCase(),t)}#u({key:e,value:t}){this.#f(e.toUpperCase(),t)}#m({key:e,value:t}){this.#_(e.toUpperCase(),t,y)}#p({key:e,value:t}){this.#_(e.toUpperCase(),t,T)}#y({key:e}){this.#A(e.toUpperCase())}#E({key:e}){this.#b(e.toUpperCase())}#S({key:e}){this.#C(e.toUpperCase(),y)}#T({key:e}){this.#C(e.toUpperCase(),T)}#O(e,t){return"number"==typeof t&&(t=String(t)),!(!e||null!==t&&"string"!=typeof t)||(this.log.error("Invalid key or value provided to setVariable:",{key:e,value:t,type:typeof t}),!1)}#v(e,t){this.#O(e,t)&&this.#a.set(e,t)}#f(e,t,s){if(!this.#O(e,t))return;const n=`${S}_${e}`,i={meta:{type:"variable"},content:t};this.#w("LOCAL",E.SET_NODE,{key:n,node:i,lockId:s})}#_(e,t,s){this.#O(e,t)&&this.dispatch(g.VAR_SAVE_REMOTE_REQUEST,{key:e,value:t,category:s})}#A(e){this.#a.delete(e)}#b(e){const t=`${S}_${e}`;this.#w("LOCAL",E.DELETE_NODE,{key:t})}#C(e,t){this.dispatch(g.VAR_DEL_REMOTE_REQUEST,{key:e,category:t})}async#o(){this.#a.clear()}#r({respond:e}){(async()=>{const t={TEMP:{},LOCAL:{},SYSTEM:{},USERSPACE:{}};t.TEMP=Object.fromEntries(this.#a);const s=await this.#w("LOCAL",E.LIST_KEYS_WITH_PREFIX,{key:`${S}_`}),n={};for(const e of s){const t=await this.#w("LOCAL",E.GET_NODE,{key:e});if(t){n[e.substring(4)]=t.content}}t.LOCAL=n;const{variables:i}=await this.request(g.VAR_LOAD_REMOTE_REQUEST,{category:[y,T]});Object.assign(t.SYSTEM,i.SYSTEM||{}),Object.assign(t.USERSPACE,i.USERSPACE||{}),e({categorized:t})})()}async#w(e,t,s){const{result:n,error:i}=await this.request(g.STORAGE_API_REQUEST,{storageName:e,api:t,data:s});if(i)throw i;return n}}const w=d("ApiManager");class f{#U;constructor(e){this.#U=e}async post(e,t={},s=null){const n=new FormData;s&&n.append("token",s);for(const[e,s]of Object.entries(t))n.append(e,s);w.log(`Making API call: action=${e}`);const i=await fetch(`${this.#U}?action=${e}`,{method:"POST",body:n});if(!i.ok)throw new Error(`API request failed with status ${i.status}: ${i.statusText}`);const a=i.headers.get("content-type");if(!a||!a.includes("application/json"))throw new Error(`Invalid response from server: Expected JSON but received ${a}. Is the server running with the --cgi flag?`);return i.json()}async get(e={}){const t=new URL(this.#U,window.location.origin);for(const[s,n]of Object.entries(e))t.searchParams.append(s,n);w.log(`Making API call (GET): url=${t}`);const s=await fetch(t,{method:"GET"});if(!s.ok)throw new Error(`API request failed with status ${s.status}: ${s.statusText}`);const n=s.headers.get("content-type");if(!n||!n.includes("application/json"))throw new Error(`Invalid response from server: Expected JSON but received ${n}. Is the server running with the --cgi flag?`);return s.json()}}const R={PS1:"PS1",HOST:"HOST",PWD:"PWD",USER:"USER",UUID:"UUID",HISTSIZE:"HISTSIZE",THEME:"THEME",ALIAS:"ALIAS",TOKEN:"TOKEN",TOKEN_EXPIRY:"TOKEN_EXPIRY"},_="guest",A="GUEST_STORAGE_",b="HISTORY";class C extends p{#I;constructor(e,t={}){super(e),this.#I=new f(t.apiUrl),this.log.log("Initializing...")}get eventHandlers(){return{[g.VAR_SAVE_REMOTE_REQUEST]:this.#D.bind(this),[g.COMMAND_PERSIST_REQUEST]:this.#L.bind(this),[g.HISTORY_LOAD_REQUEST]:this.#N.bind(this),[g.LOGIN_REQUEST]:this.#x.bind(this),[g.LOGOUT_REQUEST]:this.#P.bind(this),[g.PASSWORD_CHANGE_REQUEST]:this.#k.bind(this),[g.ADD_USER_REQUEST]:this.#V.bind(this),[g.VAR_UPDATE_DEFAULT_REQUEST]:this.#M.bind(this),[g.VAR_LOAD_REMOTE_REQUEST]:this.#q.bind(this),[g.VAR_DEL_REMOTE_REQUEST]:this.#Q.bind(this),[g.IS_LOGGED_IN_REQUEST]:this.#$.bind(this)}}async isLoggedIn(){const{value:e}=await this.request(g.VAR_GET_LOCAL_REQUEST,{key:R.TOKEN});return!!e}async start(){this.dispatch(g.USER_CHANGED_BROADCAST)}async login(e,t){try{this.log.log(`Attempting login for user: "${e}"`);const s=await this.#I.post("login",{username:e,password:t},null);return"success"===s.status&&(this.log.log("Login successful. Setting session variables."),this.dispatch(g.VAR_SET_LOCAL_REQUEST,{key:R.TOKEN,value:s.token}),this.dispatch(g.VAR_SET_LOCAL_REQUEST,{key:R.USER,value:s.user}),this.dispatch(g.VAR_SET_LOCAL_REQUEST,{key:R.TOKEN_EXPIRY,value:s.expires_at}),this.dispatch(g.USER_CHANGED_BROADCAST)),s}catch(e){return this.log.error("Network or parsing error during login:",e),{status:"error",message:`Error: ${e.message}`}}}async logout(){try{const{value:e}=await this.request(g.VAR_GET_LOCAL_REQUEST,{key:R.TOKEN}),t=await this.#I.post("logout",{},e);return("success"===t.status||"error"===t.status&&t.message.includes("expired"))&&(this.dispatch(g.VAR_DEL_LOCAL_REQUEST,{key:R.TOKEN}),this.dispatch(g.VAR_SET_LOCAL_REQUEST,{key:R.USER,value:_}),this.dispatch(g.VAR_DEL_LOCAL_REQUEST,{key:R.TOKEN_EXPIRY}),this.dispatch(g.USER_CHANGED_BROADCAST)),t}catch(e){return this.log.error("Network or parsing error during logout:",e),{status:"error",message:`Error: ${e.message}`}}}async#x({username:e,password:t,respond:s}){s(await this.login(e,t))}async#P({respond:e}){e(await this.logout())}async#H(e,t){try{return await this.#I.post("add_user",{username:e,password:t})}catch(e){return this.log.error("Network or parsing error during user creation:",e),{status:"error",message:`Error: ${e.message}`}}}async#V({username:e,password:t,respond:s}){s(await this.#H(e,t))}async#G(e,t){const{value:s}=await this.request(g.VAR_GET_LOCAL_REQUEST,{key:R.TOKEN});if(!s)return{status:"error",message:"Not logged in."};try{this.log.log("Attempting password change..."),this.log.log("Old password:",e),this.log.log("New password:",t);return await this.#I.post("change_password",{old_password:e,new_password:t},s)}catch(e){return this.log.error("Network or parsing error during password change:",e),{status:"error",message:`Error: ${e.message}`}}}async#k({oldPassword:e,newPassword:t,respond:s}){s(await this.#G(e,t))}async#$({respond:e}){e({isLoggedIn:await this.isLoggedIn()})}#M({key:e,respond:t}){switch(e){case R.USER:t({value:_});break;case R.TOKEN:t({value:""})}}async#D(e){const{value:t}=await this.request(g.VAR_GET_LOCAL_REQUEST,{key:R.USER});if(t===_){const t=`${A}${e.category}_${e.key}`,s={meta:{type:"variable"},content:e.value};this.#w("LOCAL",E.SET_NODE,{key:t,node:s})}else{const{value:t}=await this.request(g.VAR_GET_LOCAL_REQUEST,{key:R.TOKEN});this.#I.post("set_data",{category:e.category,key:e.key,value:e.value},t)}}async#Q(e){const{value:t}=await this.request(g.VAR_GET_LOCAL_REQUEST,{key:R.USER});if(t===_){const t=`${A}${e.category}_${e.key}`;this.#w("LOCAL",E.DELETE_NODE,{key:t})}else{const{value:t}=await this.request(g.VAR_GET_LOCAL_REQUEST,{key:R.TOKEN});this.#I.post("delete_data",{category:e.category,key:e.key},t)}}async#L(e){const{value:t}=await this.request(g.VAR_GET_LOCAL_REQUEST,{key:R.USER});if(t===_){const t=`${A}${b}`,{lockId:s}=await this.#w("LOCAL",E.LOCK_NODE,{key:t});try{const n=await this.#w("LOCAL",E.GET_NODE,{key:t,lockId:s}),i=n?.content||[];i.push(e.command);const a={meta:{type:"history"},content:i};await this.#w("LOCAL",E.SET_NODE,{key:t,node:a,lockId:s})}finally{await this.#w("LOCAL",E.UNLOCK_NODE,{key:t,lockId:s})}}else{const{value:e}=await this.request(g.VAR_GET_LOCAL_REQUEST,{key:R.TOKEN});this.#I.post("set_data",{category:b,key:(new Date).toISOString(),value:command},e)}}async#N({respond:e}){const{value:t}=await this.request(g.VAR_GET_LOCAL_REQUEST,{key:R.USER});if(t===_){const t=`${A}${b}`,s=await this.#w("LOCAL",E.GET_NODE,{key:t});e&&e({history:s?.content||[]})}else try{const{value:t}=await this.request(g.VAR_GET_LOCAL_REQUEST,{key:R.TOKEN}),s=await this.#I.post("get_data",{category:b},t);this.log.log("History data received from server:",s);const n=Object.keys(s.data||{}).sort().map(e=>s.data[e]);e&&e({history:n})}catch(t){this.log.error("Failed to load history from server:",t),e&&e({history:[],error:t})}}async#q({key:e,category:t,respond:s}){const{value:n}=await this.request(g.VAR_GET_LOCAL_REQUEST,{key:R.USER});if(n===_){const n={},i=Array.isArray(t)?t:[t];for(const s of i)if(void 0!==e){const t=`${A}${s}_${e}`,i=await this.#w("LOCAL",E.GET_NODE,{key:t}),a=i?i.content:void 0;void 0!==a&&(n[e]=a)}else{const e=`${A}${s}_`,i=await this.#w("LOCAL",E.LIST_KEYS_WITH_PREFIX,{key:e}),a={};for(const t of i){const s=await this.#w("LOCAL",E.GET_NODE,{key:t});if(s){a[t.substring(e.length)]=s.content}}Array.isArray(t)?n[s]=a:Object.assign(n,a)}s&&s({variables:n})}else try{const{value:n}=await this.request(g.VAR_GET_LOCAL_REQUEST,{key:R.TOKEN}),i=await this.#I.post("get_data",{category:t,key:e},n);this.log.log("Remote variables received from server:",i),s&&s({variables:i.data||{}})}catch(e){this.log.error("Failed to load remote variables from server:",e),s&&s({variables:{},error:e})}}async#w(e,t,s){const{result:n,error:i}=await this.request(g.STORAGE_API_REQUEST,{storageName:e,api:t,data:s});if(i)throw i;return n}}const O="1000";class U extends p{#F=null;#B=0;#Y=!1;constructor(e){super(e),this.log.log("Initializing...")}get eventHandlers(){return{[g.HISTORY_PREVIOUS_REQUEST]:this.#z.bind(this),[g.HISTORY_NEXT_REQUEST]:this.#j.bind(this),[g.COMMAND_EXECUTE_BROADCAST]:this.#K.bind(this),[g.HISTORY_GET_ALL_REQUEST]:this.#W.bind(this),[g.VAR_UPDATE_DEFAULT_REQUEST]:this.#M.bind(this),[g.USER_CHANGED_BROADCAST]:this.#o.bind(this)}}#K({commandString:e}){this.addCommand(e),this.resetCursor()}#M({key:e,respond:t}){e===R.HISTSIZE&&t({value:O})}async#o(){this.#F=null,this.resetCursor()}async addCommand(e){const t=e.trim();if(!t)return;const{value:s}=await this.request(g.VAR_GET_SYSTEM_REQUEST,{key:R.HISTSIZE}),n=s||O,{history:i}=await this.request(g.HISTORY_LOAD_REQUEST);i.length>0&&i[i.length-1]===t||(this.dispatch(g.COMMAND_PERSIST_REQUEST,{command:t,histsize:n}),this.resetCursor())}resetCursor(){this.#B=0,this.#Y=!1,this.#F=null}async#z(){if(!this.#Y){const{history:e}=await this.request(g.HISTORY_LOAD_REQUEST);this.#F=e.slice().reverse(),this.#Y=!0}this.#B<this.#F.length&&this.#B++;const e={command:this.#F[this.#B-1]||"",index:this.#B};this.dispatch(g.HISTORY_INDEXED_RESPONSE,e)}async#j(){this.#B>0&&this.#B--;const e={command:this.#F&&this.#F[this.#B-1]||"",index:this.#B};this.dispatch(g.HISTORY_INDEXED_RESPONSE,e)}#W({respond:e}){(async()=>{const{history:t}=await this.request(g.HISTORY_LOAD_REQUEST);if(!t||0===t.length)return void e({history:[]});const s=t.map((e,s)=>` ${String(t.length-s).padStart(String(t.length).length)}:  ${e}`);e({history:s})})()}}d("ServiceApiManager");class I{#s;constructor(e){this.#s=e}async prompt(e,t={}){return(await this.#s.request(g.INPUT_REQUEST,{prompt:e,options:t},0)).value}clearScreen(){this.#s.dispatch(g.CLEAR_SCREEN_REQUEST)}scrollToBottom(){this.#s.dispatch(g.UI_SCROLL_TO_BOTTOM_REQUEST)}async requestMedia(e){return(await this.#s.request(g.MEDIA_REQUEST,{src:e})).mediaElement}async login(e,t){return await this.#s.request(g.LOGIN_REQUEST,{username:e,password:t})}async logout(){return await this.#s.request(g.LOGOUT_REQUEST,{})}async changePassword(e,t){return await this.#s.request(g.PASSWORD_CHANGE_REQUEST,{oldPassword:e,newPassword:t})}async addUser(e,t){return await this.#s.request(g.ADD_USER_REQUEST,{username:e,password:t})}async isLoggedIn(){return(await this.#s.request(g.IS_LOGGED_IN_REQUEST,{})).isLoggedIn}async isDirectory(e){return(await this.#s.request(g.FS_IS_DIR_REQUEST,{path:e})).isDirectory}async getDirectoryContents(e){const t=await this.#s.request(g.FS_GET_DIRECTORY_CONTENTS_REQUEST,{path:e});if(t.error)throw new Error(t.error.message||"Failed to get directory contents.");return t.contents}async getFileContents(e){const t=await this.#s.request(g.FS_GET_FILE_CONTENTS_REQUEST,{path:e});if(t.error)throw new Error(t.error.message||"Failed to get file contents.");return t.contents}async getPublicUrl(e){return(await this.#s.request(g.FS_GET_PUBLIC_URL_REQUEST,{path:e})).url}async resolvePath(e,t=!1){const s=await this.#s.request(g.FS_RESOLVE_PATH_REQUEST,{path:e,mustBeDir:t});if(s.error)throw s.error;return s.path}async getHistory(){return(await this.#s.request(g.HISTORY_GET_ALL_REQUEST,{})).history}async changeDirectory(e){const t=await this.#s.request(g.FS_CHANGE_DIRECTORY_REQUEST,{path:e});if(t.error)throw t.error}setTempVariable(e,t){this.#s.dispatch(g.VAR_SET_TEMP_REQUEST,{key:e,value:t})}setLocalVariable(e,t){this.#s.dispatch(g.VAR_SET_LOCAL_REQUEST,{key:e,value:t})}setSystemVariable(e,t){this.#s.dispatch(g.VAR_SET_SYSTEM_REQUEST,{key:e,value:t})}async getSystemVariable(e,t){return await this.#s.request(g.VAR_GET_SYSTEM_REQUEST,{key:e})}setUserspaceVariable(e,t){this.#s.dispatch(g.VAR_SET_USERSPACE_REQUEST,{key:e,value:t})}deleteUserspaceVariable(e){this.#s.dispatch(g.VAR_DEL_USERSPACE_REQUEST,{key:e})}async getAllCategorizedVariables(){const{categorized:e}=await this.#s.request(g.GET_ALL_CATEGORIZED_VARS_REQUEST,{});return e}async getAliases(){return(await this.#s.request(g.GET_ALIASES_REQUEST,{})).aliases}setAliases(e){this.#s.dispatch(g.SET_ALIASES_REQUEST,{aliases:e})}async getCommandList(){return(await this.#s.request(g.GET_COMMAND_LIST_REQUEST,{})).commands}async getCommandMeta(e,t){return(await this.#s.request(g.GET_COMMAND_META_REQUEST,{commandName:e,metaKey:t})).value}async setTheme(e){return(await this.#s.request(g.SET_THEME_REQUEST,{themeName:e})).theme}async getValidThemes(){return(await this.#s.request(g.GET_VALID_THEMES_REQUEST,{})).themes}}function D(e){const t=[],s=[" ","/","="],n=["'",'"'],i=["\\"];let a="",r=null,o=!1;const l=(e="")=>{t.push(a+e),a=""};for(let t=0;t<e.length;t++){const c=e[t];o?(a+=c,o=!1):n.includes(c)?r=r===c?null:r||c:i.includes(c)?o=!0:r?a+=c:s.includes(c)?l(c):a+=c}return l(),t}class L{#X;#n;constructor(e){this.#X=e,this.#n=d(this.constructor.name.toLowerCase()),this.#n.log("Initializing...")}get services(){return this.#X}get log(){return this.#n}async autocompleteArgs(e){return[]}async execute(e){throw new Error(`Command '${this.constructor.name}' must implement the 'execute' method.`)}}async function N(e){const t=await fetch(e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status} for url: ${e}`);return t.text()}var x;x=t("H44nx");class P extends L{static DATA_FILE=new URL(x);static DESCRIPTION="A short introduction.";constructor(e){super(e)}async execute(e,t){this.log.log("Executing...");const s=document.createElement("div");s.style.whiteSpace="pre-wrap",t&&t.appendChild(s);try{const e=await N(P.DATA_FILE);this.log.log(`Welcome message loaded successfully. ${e.length} characters.`),s.textContent=e}catch(e){this.log.error("Error loading welcome message:",e),s.textContent="Error: Could not load welcome message."}}static man(){return"NAME\n       welcome - A friendly introduction to the terminal.\n\nDESCRIPTION\n       The welcome command displays a greeting message and basic instructions for using the terminal.\n       It is typically the first command executed when the terminal starts.\n\nUSAGE\n       welcome\n\n       This command takes no arguments.\n\nEXAMPLES\n       $ welcome\n       (Displays the welcome message.)"}}const k=[{Type:"Image",Source:"/fs/photos/2024/2024.04.08.jpg",Id:"profile-picture"},{Type:"Text",Title:"Name",Value:"Afshin Arefi"},{Type:"Text",Title:"Description",Value:"I am a software engineer mostly interested in low level programming, data pipelines, and data manipulation. Currently I am working at Huawei as a Senior Compiler Engineer working with llvm, the kernel, and the loader."},{Type:"Text",Title:"Email",Value:"arefi.afshin@gmail.com"},{Type:"Text",Title:"LinkedIn",Value:"https://www.linkedin.com/in/arefiafshin/"}];class V extends L{static DESCRIPTION="A short introduction.";#J;constructor(e){super(e),this.#J=e.requestMedia}static man(){return"NAME\n       about - Display information about the author.\n\nSYNOPSIS\n       about\n\nDESCRIPTION\n       The about command displays a short bio, contact information, and a profile picture."}async autocompleteArgs(e){return[]}async execute(e,t){this.log.log("Executing...");const s=t;try{for(const e of k){const t=document.createElement("div");let n;if("Text"===e.Type){n=document.createElement("p");const t=document.createElement("span");if(t.textContent=e.Title,t.classList.add("about-title"),n.appendChild(t),n.appendChild(document.createTextNode(": ")),e.Value.startsWith("http")){const t=document.createElement("a");t.href=e.Value,t.textContent=e.Value,t.target="_blank",n.appendChild(t)}else n.appendChild(document.createTextNode(e.Value))}else"Image"===e.Type&&(n=await this.#J(e.Source),n.id=e.Id);n&&(t.appendChild(n),s.appendChild(t))}}catch(e){this.log.error("Failed to fetch about information:",e),s.textContent=`Error: ${e.message}`}}}class M extends L{static DESCRIPTION="List current environment variables.";#Z;constructor(e){super(e),this.#Z=this.services.getAllCategorizedVariables}async execute(e,t){this.log.log("Executing...");const s=document.createElement("div");t&&t.appendChild(s);const n=await this.#Z();let i="";const a=(e,t)=>{if(0===Object.keys(t).length)return"";let s=`<br># ${e} Variables<br>`;for(const[e,n]of Object.entries(t))"string"==typeof n&&(/\s/.test(n)||n.startsWith("{")&&n.endsWith("}"))?s+=`${e}="${n}"<br>`:s+=`${e}=${n}<br>`;return s};i+=a("Session (In-Memory)",n.TEMP||{}),i+=a("Local (Browser Storage)",n.LOCAL),i+=a("Remote (User Account)",n.SYSTEM),i+=a("User (Configurable)",n.USERSPACE),s.innerHTML=i.trim()}static man(){return"NAME\n       env - Display environment variables.\n\nSYNOPSIS\n       env [OPTION]...\n\nDESCRIPTION\n       The env command prints the current environment variables to standard output.\n       Each variable is displayed on a new line in the format KEY=VALUE.\n\nOPTIONS\n       Currently, this command does not support any options.\n\nEXAMPLES\n       $ env\n       (Displays all current environment variables.)"}}class q extends L{static DESCRIPTION="Lists available commands.";#ee;#te;constructor(e){super(e),this.#ee=this.services.getCommandList,this.#te=this.services.getCommandMeta}static man(){return"NAME\n       help - Display information about available commands.\n\nSYNOPSIS\n       help\n\nDESCRIPTION\n       The help command lists all commands available in the terminal, along with a brief description for each.\n       It is useful for discovering what commands can be used.\n\nUSAGE\n       help\n\n       This command takes no arguments.\n\nEXAMPLES\n       $ help\n       (Displays a list of all commands and their descriptions.)"}async execute(e,t){this.log.log("Executing...");const s=document.createElement("div");t&&t.appendChild(s);const n=await this.#ee();if(0===n.length)return void(s.textContent="No commands available.");const i=Math.max(...n.map(e=>e.length))+4;let a="";for(const e of n){const t=await this.#te(e,"DESCRIPTION")||"No description available.";a+=`${e.padEnd(i)} : ${t}<br>`}s.innerHTML=a}}class Q extends L{static DESCRIPTION="Shows the manual page for a command.";#ee;#te;constructor(e){super(e),this.#ee=this.services.getCommandList,this.#te=this.services.getCommandMeta}static man(){return"NAME\n       man - Display the manual page for a command.\n\nSYNOPSIS\n       man <command>\n\nDESCRIPTION\n       The man command displays the manual page for the specified command.\n       If no command is specified, it will prompt for a command name.\n\nUSAGE\n       man <command>\n\nEXAMPLES\n       $ man help\n       (Displays the manual page for the 'help' command.)"}async autocompleteArgs(e){if(e.length>1)return[];const t=await this.#ee(),s=e[0]||"";return t.includes(s)?[]:s?t.filter(e=>e.startsWith(s)):[]}async execute(e,t){this.log.log("Executing with args:",e);const s=document.createElement("div");if(t&&t.appendChild(s),e.length<=1)return void(s.textContent="Usage: man <command>\nPlease specify a command name.");const n=e[1];if(!n)return void(s.textContent="Usage: man <command>\nPlease specify a command name.");const i=n.toLowerCase(),a=await this.#ee();this.log.log("Searching for command:",i);let r=a.find(e=>e.toLowerCase()===i),o=r?await this.#te(r,"man"):void 0;if(this.log.log("Exact match found:",r),!o){const e=a.filter(e=>e.toLowerCase().startsWith(i));if(this.log.log("Partial matches found:",e),1!==e.length)return e.length>1?(s.textContent=`man: ambiguous command '${n}'; possibilities: ${e.join(" ")}`,void this.log.warn("Ambiguous command:",{input:n,matches:e})):void(s.textContent=`No manual entry for '${n}'.`);o=await this.#te(e[0],"man"),this.log.log("Unique partial match found:",e[0])}o?(this.log.log("Displaying man page."),s.style.whiteSpace="pre-wrap",s.textContent=o):(this.log.warn(`No man page function found for command: "${n}"`),s.textContent=`No manual entry for '${n}'.`)}}class $ extends L{static DESCRIPTION="Shows the command history.";#se;constructor(e){super(e),this.#se=this.services.getHistory}static man(){return"NAME\n       history - Display the command history.\n\nSYNOPSIS\n       history\n\nDESCRIPTION\n       The history command displays a list of previously entered commands.\n\nUSAGE\n       history\n\nEXAMPLES\n       $ history\n       (Displays the list of commands entered in this session.)"}async execute(e,t){this.log.log("Executing...");const s=document.createElement("div");t&&t.appendChild(s);const n=await this.#se();if(!n||0===n.length)return void(s.textContent="No history available.");const i=n.join("<br>");s.innerHTML=i}}function H(e){const t=Array.isArray(e?.files)?e.files:[],s=[...(Array.isArray(e?.directories)?e.directories:[]).map(e=>({text:`${e.name}/`,style:{color:"var(--nnoitra-color-directory)"}})),...t.map(e=>{const t=null!==e.size?`(${e.size}b)`:"";return`${e.name} ${t}`})];return function(e){const t=document.createElement("ul");if(t.style.listStyle="none",t.style.padding="0",t.style.margin="0",e&&0!==e.length)e.forEach(e=>{const s=document.createElement("li");"string"==typeof e?s.textContent=e:"object"==typeof e&&e.text&&(s.textContent=e.text,Object.assign(s.style,e.style)),t.appendChild(s)});else{const e=document.createElement("li");e.textContent="(empty)",t.appendChild(e)}return t}(s.length>0?s:["(empty directory)"])}class G extends L{#ne;#ie;constructor(e){super(e),this.#ne=this.services.getDirectoryContents,this.#ie=this.services.autocompletePath}static man(){return"NAME\n       ls - List directory contents.\n\nSYNOPSIS\n       ls [directory]\n\nDESCRIPTION\n       The ls command lists files and directories in the specified location.\n       If no location is given, it lists the current directory."}async autocompleteArgs(e){const t=e.filter(e=>!e.trim().startsWith("-")).join("");try{const e=await this.#ne(t||"."),s=(e.directories||[]).map(e=>e.name+"/"),n=(e.files||[]).map(e=>e.name);return[...s,...n].sort()}catch(e){return this.log.warn(`Autocomplete failed for path "${t}":`,e),[]}}async execute(e,t){this.log.log("Executing with args:",e);const s=t,n=e[1]||".";try{const e=await this.#ne(n);if("string"==typeof e){const t=document.createElement("pre");return t.innerText=e,void s.appendChild(t)}const t=H(e);s.appendChild(t)}catch(e){this.log.warn(`Cannot access path: "${n}"`,e),s.textContent=`ls: cannot access '${n}': ${e.message}`}}}class F extends L{static DESCRIPTION="Change the current working directory.";#ae;#ne;constructor(e){super(e),this.#ae=this.services.changeDirectory,this.#ne=this.services.getDirectoryContents}static man(){return"NAME\n       cd - Change the current directory.\n\nSYNOPSIS\n       cd [directory]\n\nDESCRIPTION\n       The cd command changes the current working directory to the specified location.\n       If no location is given, it changes to the root directory."}async autocompleteArgs(e){const t=e.join(""),s=t.lastIndexOf("/"),n=-1===s?".":t.substring(0,s+1)||"/";try{const e=await this.#ne(n);return(e.directories||[]).map(e=>e.name+"/").sort()}catch(e){return this.log.warn(`Autocomplete failed for path "${t}":`,e),[]}}async execute(e,t){this.log.log("Executing with args:",e);const s=document.createElement("div");t&&t.appendChild(s);const n=e.slice(1).join("").trim()||"/";try{await this.#ae(n)}catch(e){s.textContent=`cd: ${n}: ${e.message}`}}}class B extends L{static DESCRIPTION="Print the content of a FILE";#re;#ne;constructor(e){super(e),this.#re=this.services.getFileContents,this.#ne=this.services.getDirectoryContents}static man(){return"NAME\n       cat - Concatenate and print files.\n\nSYNOPSIS\n       cat [FILE]...\n\nDESCRIPTION\n       The cat command reads files sequentially, writing them to the standard output."}async autocompleteArgs(e){const t=e.join("");try{const e=await this.#ne(t||"."),s=/\.txt$/i,n=(e.directories||[]).map(e=>e.name+"/"),i=(e.files||[]).filter(e=>s.test(e.name)).map(e=>e.name);return[...n,...i].sort()}catch(e){return this.log.warn(`Autocomplete failed for path "${t}":`,e),[]}}async execute(e,t){this.log.log("Executing with args:",e);const s=document.createElement("pre");t&&t.appendChild(s);const n=e.slice(1).join("").trim();if(!n)return this.log.warn("Missing file operand."),void(s.textContent="cat: missing file operand");try{const e=await this.#re(n);s.textContent=e}catch(e){this.log.error(`Failed to get file content for "${n}":`,e),s.textContent=`cat: ${n}: ${e.message}`}}}class Y extends L{static DESCRIPTION="Clear the terminal output.";#oe;constructor(e){super(e),this.#oe=this.services.clearScreen}execute(e,t){this.log.log("Executing clear command."),this.#oe()}static man(){return"NAME\n       clear - Clear the terminal output.\n\nSYNOPSIS\n       clear\n\nDESCRIPTION\n       The clear command erases all output in the terminal window."}}class z extends L{static DESCRIPTION="View a photo or video.";#ne;#le;#J;constructor(e){super(e),this.#ne=this.services.getDirectoryContents,this.#le=this.services.getPublicUrl,this.#J=this.services.requestMedia}static man(){return"NAME\n       view - Display an image or video file.\n\nSYNOPSIS\n       view [file]\n\nDESCRIPTION\n       The view command displays the specified image (png, jpg, gif) or video (mp4, webm) file.\n       The path can be absolute or relative to the current directory."}async autocompleteArgs(e){const t=e.join("");try{const e=await this.#ne(t||"."),s=/\.(png|jpg|jpeg|gif|webp|mp4|webm)$/i,n=(e.directories||[]).map(e=>e.name+"/"),i=(e.files||[]).filter(e=>s.test(e.name)).map(e=>e.name);return[...n,...i].sort()}catch(e){return this.log.warn(`Autocomplete failed for path "${t}":`,e),[]}}async execute(e,t){this.log.log("Executing with args:",e);const s=document.createElement("div");t&&t.appendChild(s);const n=e.slice(1).join("").trim();if(!n)return this.log.warn("Missing file operand."),void(s.textContent="view: missing file operand");if(!/\.(png|jpg|jpeg|gif|webp|mp4|webm)$/i.test(n))return this.log.warn(`File is not a supported media type: "${n}"`),void(s.textContent=`view: ${n}: Unsupported file type.`);const i=await this.#le(n),a=await this.#J(i);s.appendChild(a)}}class j extends L{static DESCRIPTION="Add a new user.";#ce;#H;constructor(e){super(e),this.#ce=this.services.prompt,this.#H=this.services.addUser}static man(){return"\nNAME\n       adduser - Add a new user.\n\nSYNOPSIS\n       adduser [username]\n\nDESCRIPTION\n       The adduser command creates a new user account. You will be prompted to enter and confirm a password.\n       Usernames must be between 3 and 32 characters and can only contain letters, numbers, and underscores.\n"}async autocompleteArgs(e){return{suggestions:[],description:"<USERNAME>"}}async execute(e,t){this.log.log("Executing with args:",e);const s=document.createElement("div");t&&t.appendChild(s);const n=e[1];if(!n)return void(s.textContent="adduser: missing username operand.");if(/^[a-zA-Z0-9_]{3,32}$/.test(n))try{const e=await this.#ce("Password: ",{isSecret:!0,allowHistory:!1,allowAutocomplete:!1});if(null===e)throw new Error("Operation cancelled.");s.innerHTML+="Password received.<br>";const t=await this.#ce("Confirm password: ",{isSecret:!0,allowHistory:!1,allowAutocomplete:!1});if(null===t)throw new Error("Operation cancelled.");if(s.innerHTML+="Confirmation received.<br>",e!==t)return void(s.innerHTML+="<br>adduser: Passwords do not match. User not created.");s.innerHTML+="Creating user...";const i=await this.#H(n,e);s.innerHTML+="<br>"+("success"===i.status?`User '${n}' created successfully.`:`adduser: ${i.message}`)}catch(e){this.log.error("Error during user creation:",e),s.innerHTML+="<br>adduser: Operation cancelled."}else s.textContent=`adduser: invalid username '${n}'. Usernames must be 3-32 characters and contain only letters, numbers, and underscores.`}}class K extends L{static DESCRIPTION="Log in as a user.";#ce;#he;constructor(e){super(e),this.#ce=this.services.prompt,this.#he=this.services.login}static man(){return"NAME\n       login - Log in to the system.\n\nSYNOPSIS\n       login [username]\n\nDESCRIPTION\n       Authenticates the user and starts a session."}async autocompleteArgs(e){return e.length>1?[]:{suggestions:[],description:"<USERNAME>"}}static isAvailable(e){return!e.isLoggedIn}async execute(e,t){this.log.log("Executing with args:",e);const s=document.createElement("div");t&&t.appendChild(s);const n=e[1];if(!n)return void(s.textContent="Usage: login <username>");this.log.log("Prompting user for password.");const i=await this.#ce("Password: ",{isSecret:!0,allowHistory:!1,allowAutocomplete:!1});if(null!==i)try{const e=await this.#he(n,i);s.textContent=e.message}catch(e){this.log.error("Network or parsing error during login:",e),s.textContent=`Error: ${e.message}`}else s.textContent="login: Operation cancelled."}}class W extends L{static DESCRIPTION="Log out of the current session.";#de;constructor(e){super(e),this.#de=this.services.logout}static man(){return"NAME\n       logout - Log out of the system.\n\nSYNOPSIS\n       logout\n\nDESCRIPTION\n       Ends the current user session."}static isAvailable(e){return e.isLoggedIn}async execute(e,t){this.log.log("Executing...");const s=document.createElement("div");t&&t.appendChild(s);try{const e=await this.#de();s.textContent=e.message}catch(e){this.log.error("Network or parsing error during logout:",e),s.textContent=`Error: ${e.message}`}}}class X extends L{static DESCRIPTION="Change user password.";#ce;#G;constructor(e){super(e),this.#ce=this.services.prompt,this.#G=this.services.changePassword}static man(){return"\nNAME\n       passwd - change user password\n\nSYNOPSIS\n       passwd\n\nDESCRIPTION\n       The passwd command changes the password for the current user.\n       You will be prompted for your old password, and then for the new password twice.\n"}static isAvailable(e){return!0}async execute(e,t){this.log.log("Executing...");const s={isSecret:!0,allowHistory:!1,allowAutocomplete:!1};try{const e=await this.#ce("Old password: ",s);if(null===e)throw new Error("Operation cancelled.");t.innerHTML+="Old password received.<br>";const n=await this.#ce("New password: ",s);if(null===n)throw new Error("Operation cancelled.");t.innerHTML+="New password received.<br>";const i=await this.#ce("Confirm new password: ",s);if(null===i)throw new Error("Operation cancelled.");if(t.innerHTML+="Confirmation received.<br>",n!==i)return void(t.innerHTML+="<br>passwd: Passwords do not match. Password not changed.");if(!n)return void(t.innerHTML+="<br>passwd: Password cannot be empty.");t.innerHTML+="Changing password...";const a=await this.#G(e,n);t.innerHTML+=`<br>${a.message}`}catch(e){this.log.warn("Password change operation cancelled or failed:",e),t.innerHTML+="passwd: Operation cancelled."}}}class J extends L{static DESCRIPTION="Define or display aliases.";#ue;#me;constructor(e){super(e),this.#ue=this.services.getAliases,this.#me=this.services.setAliases}static man(){return"NAME\n       alias - Define or display command aliases.\n\nSYNOPSIS\n       alias [name[=value] ...]\n\nDESCRIPTION\n       The alias command allows you to create shortcuts for longer commands.\n\n       - With no arguments, 'alias' prints the list of all current aliases.\n       - With 'name=value', it defines an alias. The value can be a string in quotes.\n\nEXAMPLES\n       $ alias\n       (Displays all aliases.)\n\n       $ alias l=\"ls -l\"\n       (Creates an alias 'l' for 'ls -l'.)"}async execute(e){this.log.log("Executing with args:",e);document.createElement("div").style.whiteSpace="pre-wrap";const t=await this.#ue();if(e.length<=1){if(0===Object.keys(t).length)this.log.log("No aliases found to display."),outputDiv.textContent="No aliases defined.";else{let e="";for(const[s,n]of Object.entries(t))e+=`alias ${s}='${n}'<br>`;outputDiv.innerHTML=e,this.log.log("Displaying all defined aliases.")}return}const s=e.slice(1).join(""),n=s.indexOf("=");if(-1===n)return void(outputDiv.textContent="alias: usage: alias [name[=value] ...]");const i=s.substring(0,n).trim();let a=s.substring(n+1).trim();(a.startsWith('"')&&a.endsWith('"')||a.startsWith("'")&&a.endsWith("'"))&&(a=a.slice(1,-1)),i?(t[i]=a,this.#me(t),this.log.log(`Created alias: ${i}='${a}'`)):(this.log.warn("Invalid alias format:",s),outputDiv.textContent="alias: invalid alias name")}}class Z extends L{static DESCRIPTION="Remove an alias.";#ue;#me;constructor(e){super(e),this.#ue=this.services.getAliases,this.#me=this.services.setAliases}static man(){return"NAME\n       unalias - Remove an alias.\n\nSYNOPSIS\n       unalias <alias_name>\n\nDESCRIPTION\n       The unalias command removes the specified alias from the list of defined aliases.\n\nEXAMPLES\n       $ unalias l\n       (Removes the alias 'l'.)"}async autocompleteArgs(e){if(e.length>1)return[];const t=await this.#ue(),s=Object.keys(t),n=e[0]||"";return s.filter(e=>e.startsWith(n))}async execute(e,t){this.log.log("Executing with args:",e);const s=document.createElement("div");t&&t.appendChild(s);const n=e[1];if(!n)return this.log.warn("No alias name provided."),void(s.textContent="unalias: usage: unalias <alias_name>");const i=await this.#ue();n in i?(this.log.log(`Removing alias: "${n}"`),delete i[n],this.#me(i),s.textContent=`Alias '${n}' removed.`):(this.log.warn(`Alias not found: "${n}"`),s.textContent=`unalias: ${n}: not found`)}}function ee(e){const t=e.match(/^([^=]+)=(.*)$/);if(!t)return null;return{name:t[1].trim(),value:t[2].trim().replace(/^['"]|['"]$/g,"")}}class te extends L{static DESCRIPTION="Set or display user environment variables.";#ge;#Z;constructor(e){super(e),this.#ge=this.services.setUserspaceVariable,this.#Z=this.services.getAllCategorizedVariables}static man(){return"NAME\n       export - Set or display user environment variables.\n\nSYNOPSIS\n       export [name[=value] ...]\n\nDESCRIPTION\n       The export command allows you to view and modify user-configurable environment variables.\n       These variables are saved to your user profile.\n\n       - With no arguments, 'export' prints the list of all current user variables.\n       - With 'name=value', it defines a variable. The value can be a string in quotes.\n\nEXAMPLES\n       $ export\n       (Displays all user-configurable variables.)\n\n       $ export PS1=\"{user}$ \"\n       (Changes the command prompt format.)"}async autocompleteArgs(e){if(e.length>1)return[];const t=e[0]||"",s=(await this.#Z()).USERSPACE,n=Object.keys(s),i=t.split("="),a=i[0].toUpperCase();if(1===i.length){const e=n.filter(e=>e.startsWith(a));return 1===e.length?[`${e[0]}=`]:e}if(i.length>1&&s.hasOwnProperty(a)){const e=s[a];return[`${a}="${e}"`]}return[]}async execute(e,t){this.log.log("Executing with args:",e);const s=document.createElement("div");t&&t.appendChild(s);const n=e.slice(1).join(" "),i=await this.#Z(),a=i.USERSPACE||{};if(!n){let e="";for(const[t,s]of Object.entries(a))e+=`export ${t}="${s}"<br>`;return void(s.innerHTML=e.trim()||"No user variables defined.")}const r=ee(n);if(r){const e=r.name.toUpperCase();i.SYSTEM&&i.SYSTEM.hasOwnProperty(e)||i.LOCAL&&i.LOCAL.hasOwnProperty(e)||i.TEMP&&i.TEMP.hasOwnProperty(e)?s.textContent=`export: permission denied: \`${r.name}\` is a read-only variable.`:(this.#ge(e,r.value),this.log.log(`Set variable: ${r.name}='${r.value}'`))}else s.textContent='export: invalid format. Use name="value"',this.log.warn("Invalid export format:",n)}}class se extends L{static DESCRIPTION="Remove a user environment variable.";#pe;#Z;constructor(e){super(e),this.#pe=this.services.deleteUserspaceVariable,this.#Z=this.services.getAllCategorizedVariables}static man(){return"NAME\n       unset - Remove a user environment variable.\n\nSYNOPSIS\n       unset <variable_name>\n\nDESCRIPTION\n       The unset command removes the specified variable from the list of user-defined environment variables.\n       It can only remove variables set with the 'export' command.\n\nEXAMPLES\n       $ unset MY_VAR\n       (Removes the user variable 'MY_VAR'.)"}async autocompleteArgs(e){if(e.length>1)return[];const t=(await this.#Z()).USERSPACE||{},s=Object.keys(t),n=(e[0]||"").toUpperCase();return s.filter(e=>e.startsWith(n))}async execute(e,t){this.log.log("Executing with args:",e);const s=document.createElement("div");t&&t.appendChild(s);const n=e[1];if(!n)return void(s.textContent="unset: usage: unset <variable_name>");const i=n.toUpperCase(),a=(await this.#Z()).USERSPACE||{};Object.keys(a).includes(i)?await this.#pe(i):s.textContent=`unset: ${n}: not found in userspace`}}class ne extends L{static DESCRIPTION="Set the terminal color theme.";#Ee;#Se;#ye;constructor(e){super(e),this.#Ee=this.services.setTheme,this.#ye=this.services.getSystemVariable,this.#Se=this.services.getValidThemes}static man(){return"NAME\n       theme - Set the terminal color theme.\n\nSYNOPSIS\n       theme [color]\n\nDESCRIPTION\n       Changes the terminal's color scheme. The selected theme is saved to your user profile.\n\n       Available colors: green, yellow, orange, red\n\nEXAMPLES\n       $ theme\n       (Displays the current theme.)\n\n       $ theme yellow\n       (Sets the theme to yellow.)"}async autocompleteArgs(e){if(e.length>1)return[];const t=e[0]||"";return(await this.#Se()).filter(e=>e.startsWith(t))}async execute(e,t){const s=document.createElement("div");t&&t.appendChild(s);const n=e[1],i=await this.#Se();if(!n){const{value:e}=await this.#ye("THEME");return void(s.innerHTML=`Current theme: ${e}<br>Available themes: ${i.join(", ")}`)}i.includes(n)?(this.#Ee(n),s.textContent=`Theme set to '${n}'.`,this.log.log(`Theme set to: ${n}`)):(s.innerHTML=`Error: Invalid theme '${n}'.<br>Available themes: ${i.join(", ")}`,this.log.warn(`Invalid theme name provided: ${n}`))}}var ie;ie=t("ccCIq");class ae extends L{static DATA_FILE=new URL(ie);static DESCRIPTION="Show version information.";constructor(e){super(e)}async execute(e,t){this.log.log("Executing...");const s=document.createElement("pre");t&&t.appendChild(s);try{const e=await fetch(ae.DATA_FILE);if(!e.ok)throw new Error(`Failed to load version information: ${e.statusText}`);const t=await e.text();s.textContent=t}catch(e){this.log.error("Error loading version information:",e),s.textContent="Error: Could not load version information."}}static man(){return"NAME\n       version - Show version information.\n\nDESCRIPTION\n       The version command displays the application's version and build information."}}class re extends L{static DESCRIPTION="Display the current date and time.";constructor(e){super(e)}async execute(e,t){this.log.log("Executing...");const s=document.createElement("div");t&&t.appendChild(s),s.textContent=(new Date).toString()}static man(){return"NAME\n       date - Display the current date and time.\n\nSYNOPSIS\n       date\n\nDESCRIPTION\n       The date command prints the current system date and time to standard output."}}class oe extends L{static DESCRIPTION="Display a calendar.";constructor(e){super(e)}async execute(e,t){this.log.log("Executing...");const s=document.createElement("pre");t&&t.appendChild(s);const n=new Date,i=n.getFullYear(),a=n.getMonth(),r=n.toLocaleString("default",{month:"long"}),o=new Date(i,a,1).getDay(),l=new Date(i,a+1,0).getDate(),c=`${r} ${i}`,h=Math.floor((20-c.length)/2);let d=" ".repeat(h)+c+"\n";d+="Su Mo Tu We Th Fr Sa\n",d+=" ".repeat(3*o);for(let e=1;e<=l;e++)d+=String(e).padStart(2," ")+" ",(e+o)%7==0&&e<l&&(d+="\n");s.textContent=d.trimEnd()}static man(){return"NAME\n       cal - Display a calendar.\n\nSYNOPSIS\n       cal\n\nDESCRIPTION\n       The cal command displays a calendar for the current month."}}class le extends p{#Te=new Map;#ve;constructor(e){super(e),this.#ve=new I(e),this.#we(),this.log.log("Initializing...")}#we(){this.register("welcome",P,[]),this.register("about",V,["requestMedia"]),this.register("env",M,["getAllCategorizedVariables"]),this.register("help",q,["getCommandList","getCommandMeta"]),this.register("man",Q,["getCommandList","getCommandMeta"]),this.register("history",$,["getHistory"]),this.register("ls",G,["getDirectoryContents"]),this.register("cd",F,["changeDirectory","getDirectoryContents"]),this.register("cat",B,["getFileContents","getDirectoryContents"]),this.register("clear",Y,["clearScreen"]),this.register("view",z,["getDirectoryContents","getPublicUrl","requestMedia"]),this.register("adduser",j,["prompt","addUser"]),this.register("login",K,["prompt","login"]),this.register("logout",W,["logout"]),this.register("passwd",X,["prompt","changePassword"]),this.register("alias",J,["getAliases","setAliases"]),this.register("unalias",Z,["getAliases","setAliases"]),this.register("export",te,["setUserspaceVariable","getAllCategorizedVariables"]),this.register("unset",se,["deleteUserspaceVariable","getAllCategorizedVariables"]),this.register("theme",ne,["getValidThemes","setTheme","getSystemVariable"]),this.register("version",ae,[]),this.register("date",re,[]),this.register("cal",oe,[])}get eventHandlers(){return{[g.COMMAND_EXECUTE_BROADCAST]:this.#fe.bind(this),[g.GET_ALIASES_REQUEST]:this.#Re.bind(this),[g.SET_ALIASES_REQUEST]:this.#_e.bind(this),[g.GET_AUTOCOMPLETE_SUGGESTIONS_REQUEST]:this.#Ae.bind(this),[g.VAR_UPDATE_DEFAULT_REQUEST]:this.#M.bind(this),[g.GET_COMMAND_LIST_REQUEST]:this.#be.bind(this),[g.GET_COMMAND_META_REQUEST]:this.#Ce.bind(this)}}register(e,t,s=[]){this.#Te.set(e,{CommandClass:t,requiredServices:s})}#fe({commandString:e,outputElement:t}){this.execute(e,t)}getCommand(e){const t=this.#Te.get(e);if(t){const{CommandClass:s,requiredServices:n=[]}=t;return new s(n.reduce((t,s)=>("function"==typeof this.#ve[s]?t[s]=this.#ve[s].bind(this.#ve):this.log.warn(`Command '${e}' requested unknown function '${s}'.`),t),{}))}return null}getCommandClass(e){const t=this.#Te.get(e);return t?t.CommandClass:void 0}getCommandNames(){return Array.from(this.#Te.keys())}async#Oe(){const e=await this.getPermittedCommandNames();return[...new Set([...e])].sort()}async getPermittedCommandNames(){const e=this.getCommandNames(),t=await this.#Ue();return e.filter(e=>{const s=this.getCommandClass(e);return!s||"function"!=typeof s.isAvailable||s.isAvailable(t)}).sort()}async#Ue(){return{isLoggedIn:await this.#ve.isLoggedIn()}}async#Ie(e){let t=[...e],s=(t[0]||"").trim();if(!s)return{commandName:"",args:[]};const n=await this.#ve.getAliases();if(n[s]){const e=D(n[s]),i=t.slice(1);t=[...e,...i],s=(t[0]||"").trim()}return{commandName:s,args:t}}async execute(e,t){try{const s=e.trim();if(!s)return;const n=D(s);if(0===n.length)return;const{commandName:i,args:a}=await this.#Ie(n);if(!i)return;const r=t?t.element:null;if(this.#Te.has(i))try{const e=this.getCommand(i);this.log.log(`Executing command: "${a}"`),await e.execute(a,r)}catch(e){r&&(r.textContent=`Error executing ${i}: ${e.message}`),this.log.error(`Error executing ${i}:`,e)}else r&&(r.textContent=`${i}: command not found`)}finally{this.dispatch(g.COMMAND_EXECUTION_FINISHED_BROADCAST)}}async#Re({respond:e}){try{const{value:t}=await this.request(g.VAR_GET_SYSTEM_REQUEST,{key:R.ALIAS});e({aliases:JSON.parse(t||"{}")})}catch(t){this.log.error("Failed to get aliases:",t),e({aliases:{}})}}#_e({aliases:e}){this.dispatch(g.VAR_SET_SYSTEM_REQUEST,{key:R.ALIAS,value:JSON.stringify(e)})}async#be({respond:e}){e({commands:await this.getPermittedCommandNames()})}#Ce({commandName:e,metaKey:t,respond:s}){const n=this.getCommandClass(e);if(n&&void 0!==n[t]){const e=n[t];s("function"==typeof e?{value:e()}:{value:e})}else s({value:void 0})}async#Ae({parts:e,respond:t}){let s=[],n="";if(e.length<=1){s=(await this.#Oe()).map(e=>e+" ")}else{const{commandName:t,args:i}=await this.#Ie(e),a=this.getCommandClass(t);if(a&&"function"==typeof a.prototype.autocompleteArgs){const e=this.getCommand(t),a=await e.autocompleteArgs(i.slice(1));Array.isArray(a)?s=a:"object"==typeof a&&null!==a&&(s=a.suggestions||[],n=a.description||"")}}t({suggestions:s,description:n})}#M({key:e,respond:t}){if(e===R.ALIAS){t({value:"{}"})}}}function ce(e,t,s){if(!e)return t;let n;return n="~"===e?s:e.startsWith("~/")?`${s}${e.substring(1)}`:e.startsWith("/")?e:`${"/"===t?"":t}/${e}`,function(e){if(!e)return"/";const t=e.split("/"),s=[];for(const e of t)".."===e?s.length>0&&s.pop():"."!==e&&""!==e&&s.push(e);return"/"+s.join("/")}(n)}class he extends p{#I;#De={SESSION:[g.STORAGE_API_REQUEST,"SESSION"],LOCAL:[g.STORAGE_API_REQUEST,"LOCAL"],REMOTE:[g.STORAGE_API_REQUEST,"REMOTE"]};#Le={"/":{DEVICE:this.#De.SESSION,UUID:"91e05212-d341-41f2-a4dd-615240ac62fc"},"/home":{DEVICE:this.#De.REMOTE,UUID:"a3771916-158b-47af-a78c-1151538590f0"},"/home/guest":{DEVICE:this.#De.LOCAL,UUID:"897ba474-ff01-4312-bc06-4127dd49fc3c"},"/var/local":{DEVICE:this.#De.LOCAL,UUID:"eb8ac8ed-cc20-4286-aded-1b0810c1e99c"},"/var/remote":{DEVICE:this.#De.REMOTE,UUID:"3c77ca09-8bb7-4e63-bea8-5c08ec325264"},"/var/session":{DEVICE:this.#De.SESSION,UUID:"867486bd-2424-40b7-afb1-7e651fbd0bb9"}};constructor(e,t={}){super(e),this.#I=new f(t.apiUrl),this.log.log("Initializing...")}get eventHandlers(){return{[g.FS_GET_FILE_CONTENTS_REQUEST]:this.#Ne.bind(this),[g.FS_GET_DIRECTORY_CONTENTS_REQUEST]:this.#xe.bind(this),[g.FS_CHANGE_DIRECTORY_REQUEST]:this.#Pe.bind(this),[g.FS_RESOLVE_PATH_REQUEST]:this.#ke.bind(this),[g.FS_GET_PUBLIC_URL_REQUEST]:this.#Ve.bind(this),[g.VAR_UPDATE_DEFAULT_REQUEST]:this.#M.bind(this)}}async#Me(e){const t=await this.#qe(e);let{storageName:s,uuid:n}=await this.#Qe();if("/"===t)return{storageName:s,uuid:n};const i=t.substring(1).split("/");for(let t=0;t<i.length;t++){const a=i[t],r=t===i.length-1,o=await this.#$e(s,n,a);if(o.notFound){if(r)return{storageName:s,parentUuid:n,childName:a};throw new Error(`Path not found: ${a} in ${e}`)}s=o.storageName,n=o.uuid}return{storageName:s,uuid:n}}async#qe(e){const[t,s]=await Promise.all([this.request(g.VAR_GET_TEMP_REQUEST,{key:R.PWD}),this.request(g.VAR_GET_LOCAL_REQUEST,{key:R.USER})]),n=`/home/${s.value}`;return ce(e,t.value,n)}async#Qe(){const{DEVICE:[e,t],UUID:s}=this.#Le["/"];let n=await this.#w(t,E.GET_NODE,{key:s});return n||(n={meta:{type:"directory"},content:JSON.stringify([])},await this.#w(t,E.SET_NODE,{key:s,node:n})),{storageName:t,uuid:s}}async#$e(e,t,s){const n=await this.#w(e,E.GET_NODE,{key:t});if(!n||"directory"!==n.meta.type)throw new Error("Path component is not a directory.");const i=JSON.parse(n.content||"[]").find(e=>e[1]===s);if(!i)return{notFound:!0};let a=i[0];const r=await this.#w(e,E.GET_NODE,{key:a});return"mount"===r.meta.type?{storageName:r.meta.targetStorage,uuid:r.meta.targetUuid}:{storageName:e,uuid:a}}async#He(e,t){const{storageName:s,parentUuid:n,childName:i,uuid:a}=await this.#Me(e);let r=a;if(r){const e=await this.#w(s,E.GET_NODE,{key:r});if("directory"===e.meta.type)throw new Error("Cannot write to a directory.");e.content=t,await this.#w(s,E.SET_NODE,{key:r,node:e})}else{if(!n||!i)throw new Error("Cannot create file in a non-existent directory.");r=crypto.randomUUID();const e={meta:{type:"file"},content:t};await this.#w(s,E.SET_NODE,{key:r,node:e});const{lockId:a}=await this.#w(s,E.LOCK_NODE,{key:n});try{const e=await this.#w(s,E.GET_NODE,{key:n,lockId:a}),t=JSON.parse(e.content);t.push([r,i]),e.content=JSON.stringify(t),await this.#w(s,E.SET_NODE,{key:n,node:e,lockId:a})}finally{await this.#w(s,E.UNLOCK_NODE,{key:n,lockId:a})}}}async#Ge(e){const{storageName:t,uuid:s}=await this.#Me(e);if(!s)throw new Error("File not found.");const n=await this.#w(t,E.GET_NODE,{key:s});if(!n||"file"!==n.meta.type)throw new Error("Path is not a file.");return n.content}async#Fe(e){const{storageName:t,uuid:s}=await this.#Me(e);if(!s)throw new Error("File not found.");await this.#w(t,E.DELETE_NODE,{key:s})}async#Be(e){const{storageName:t,parentUuid:s,childName:n,uuid:i}=await this.#Me(e);if(i)throw new Error("Directory already exists.");if(!s||!n)throw new Error("Cannot create directory in a non-existent path.");const a=crypto.randomUUID(),r={meta:{type:"directory"},content:JSON.stringify([])};await this.#w(t,E.SET_NODE,{key:a,node:r});const{lockId:o}=await this.#w(t,E.LOCK_NODE,{key:s});try{const e=await this.#w(t,E.GET_NODE,{key:s,lockId:o}),i=JSON.parse(e.content);i.push([a,n]),e.content=JSON.stringify(i),await this.#w(t,E.SET_NODE,{key:s,node:e,lockId:o})}finally{await this.#w(t,E.UNLOCK_NODE,{key:s,lockId:o})}}async#Ye(e){const{storageName:t,uuid:s}=await this.#Me(e);if(!s)throw new Error("Directory not found.");await this.#w(t,E.DELETE_NODE,{key:s})}async#ze(e){const{storageName:t,uuid:s}=await this.#Me(e);if(!s)return{path:e,isDirectory:!1,isFile:!1};const n=await this.#w(t,E.GET_NODE,{key:s});return{path:e,isDirectory:"directory"===n.meta.type||"mount"===n.meta.type,isFile:"file"===n.meta.type}}async#je(e){const{storageName:t,uuid:s}=await this.#Me(e);if(!s)throw new Error("Directory not found.");const n=await this.#w(t,E.GET_NODE,{key:s});if("directory"!==n.meta.type&&"mount"!==n.meta.type)throw new Error("Not a directory.");const i=JSON.parse(n.content||"[]");return(await Promise.all(i.map(e=>this.#w(t,E.GET_NODE,{key:e[0]})))).map((e,t)=>({name:i[t][1],...e.meta}))}async#xe({path:e,respond:t}){try{t({contents:await this.#ne(e)})}catch(e){t({error:e})}}async#Ne({path:e,respond:t}){try{t({contents:await this.#re(e)})}catch(e){t({error:e})}}async#Pe({path:e,respond:t}){try{const s=await this.#Ke(e,!0);this.dispatch(g.VAR_SET_TEMP_REQUEST,{key:R.PWD,value:s}),t({success:!0})}catch(e){t({error:e})}}async#ke({path:e,respond:t}){try{t({path:await this.#Ke(e,!1)})}catch(e){t({error:e})}}async#Ve({path:e,respond:t}){try{const{value:s}=await this.request(g.VAR_GET_TEMP_REQUEST,{key:R.PWD});t({url:(await this.#We("get_public_url",{path:e,pwd:s})).url})}catch(e){t({error:e})}}#M({key:e,respond:t}){e===R.PWD&&(this.dispatch(g.VAR_SET_TEMP_REQUEST,{key:e,value:"/"}),t({value:"/"}))}async#ne(e){const{value:t}=await this.request(g.VAR_GET_TEMP_REQUEST,{key:R.PWD});return this.#We("ls",{path:e,pwd:t})}async#re(e){const{value:t}=await this.request(g.VAR_GET_TEMP_REQUEST,{key:R.PWD});return(await this.#We("cat",{path:e,pwd:t})).content}async#We(e,t={}){try{const s=await this.#I.get({action:e,...t});if(s.error)throw new Error(s.error);return s}catch(s){throw this.log.error(`Error during API request for action "${e}" with path "${t.path}":`,s),s}}async#Ke(e,t){const{value:s}=await this.request(g.VAR_GET_TEMP_REQUEST,{key:R.PWD});return(await this.#We("resolve",{path:e,pwd:s,must_be_dir:t})).path}async#w(e,t,s){const{result:n,error:i}=await this.request(g.STORAGE_API_REQUEST,{storageName:e,api:t,data:s});if(i)throw i;return n}}const de="THEME",ue="green";class me extends p{static VALID_THEMES=["green","yellow","orange","red"];#Xe=null;constructor(e){super(e),this.log.log("Initializing...")}setView(e){this.#Xe=e,this.log.log("View connected.")}async start(){const{value:e}=await this.request(g.VAR_GET_SYSTEM_REQUEST,{key:de}),t=e||ue;this.applyTheme(t)}get eventHandlers(){return{[g.SET_THEME_REQUEST]:this.#Je.bind(this),[g.VAR_UPDATE_DEFAULT_REQUEST]:this.#M.bind(this),[g.GET_VALID_THEMES_REQUEST]:this.#Ze.bind(this),[g.USER_CHANGED_BROADCAST]:this.#o.bind(this)}}#Je({themeName:e,respond:t}){t({theme:this.applyTheme(e)})}async#o(){this.log.log("User changed, re-evaluating theme.");const{value:e}=await this.request(g.VAR_GET_SYSTEM_REQUEST,{key:de}),t=e||ue;this.applyTheme(t,!1)}#M({key:e,respond:t}){e===de&&(this.dispatch(g.VAR_SET_SYSTEM_REQUEST,{key:e,value:ue}),t({value:ue}))}#Ze({respond:e}){e({themes:this.getValidThemes()})}applyTheme(e){const t=me.VALID_THEMES.includes(e)?e:ue;if(this.#Xe){const e=`var(--nnoitra-color-${t})`;this.#Xe.style.setProperty("--nnoitra-color-theme",e)}return this.dispatch(g.THEME_CHANGED_BROADCAST,{themeName:t}),this.dispatch(g.VAR_SET_SYSTEM_REQUEST,{key:de,value:t}),this.log.log(`Applied theme: ${t}`),t}getValidThemes(){return me.VALID_THEMES}}class ge extends p{#Xe=null;#et="";#tt=!1;#st=!1;#nt=!1;#it=!1;constructor(e){super(e),this.log.log("Initializing...")}setView(e){this.#Xe=e,this.#Xe.addEventListener("enter",e=>this.#at(e.detail.value)),this.#Xe.addEventListener("tab",()=>this.#rt()),this.#Xe.addEventListener("arrow-up",()=>this.#ot()),this.#Xe.addEventListener("arrow-down",()=>this.#lt()),this.#Xe.addEventListener("swipe-right",()=>this.#rt()),this.#Xe.setAttribute("disabled","")}get eventHandlers(){return{[g.INPUT_REQUEST]:this.#ct.bind(this),[g.HISTORY_INDEXED_RESPONSE]:this.#ht.bind(this),[g.AUTOCOMPLETE_BROADCAST]:this.#dt.bind(this)}}#at(e){this.respond&&(this.#ut(e),this.#it=!1,this.#Xe.clear())}#rt(){this.log.log("Tab key pressed - triggering autocomplete if allowed.",this.#nt),this.#nt&&this.#mt(this.#Xe.getValue())}#ot(){this.#st&&(this.#it||(this.#et=this.#Xe.getValue(),this.#it=!0),this.#Xe.setAttribute("disabled",""),this.dispatch(g.HISTORY_PREVIOUS_REQUEST))}#lt(){this.log.log("ArrowDown key pressed - requesting next history if allowed."),this.#st&&this.#it&&(this.#Xe.setAttribute("disabled",""),this.dispatch(g.HISTORY_NEXT_REQUEST))}#mt(e){if(this.#nt){this.#Xe.setAttribute("disabled","");const t=this.#Xe.getCursorPosition(),s=e.substring(0,t),n=e.substring(t);this.log.log("Dispatching autocomplete request:",{beforeCursorText:s,afterCursorText:n}),this.dispatch(g.AUTOCOMPLETE_REQUEST,{beforeCursorText:s,afterCursorText:n})}}#gt(e,t={}){this.#tt=t.isSecret||!1,this.#st=t.allowHistory||!1,this.#nt=t.allowAutocomplete||!1,this.#et="",this.#it=!1,this.#Xe.clear(),this.#Xe.removeAttribute("disabled"),this.#Xe.setAttribute("placeholder",e),this.#tt?this.#Xe.setAttribute("secret",""):this.#Xe.removeAttribute("secret"),this.#Xe.focus()}#ut(e){this.respond({value:e}),this.#Xe.setAttribute("disabled","")}#ct(e){const{prompt:t,options:s,respond:n}=e;this.#gt(t,s),this.respond=n}#ht(e){this.#Xe&&(this.#Xe.removeAttribute("disabled"),void 0!==e.command&&(e.index>0?(this.#Xe.setValue(e.command),this.#Xe.setAttribute("icon-text",`H:${e.index}`)):(this.#Xe.setValue(this.#et),this.#it=!1,this.#et="",this.#Xe.removeAttribute("icon-text"))))}#dt(e){if(this.#Xe)try{const{newTextBeforeCursor:t,afterCursorText:s}=e;if(void 0!==t){const e=t+s;this.#Xe.setValue(e),this.#Xe.setCursorPosition(t.length)}}finally{this.#Xe.removeAttribute("disabled")}}}class pe extends p{#Xe=null;#pt;constructor(e){super(e),this.log.log("Initializing...")}setView(e){this.#Xe=e,this.#pt=new ResizeObserver(()=>{this.dispatch(g.UI_SCROLL_TO_BOTTOM_REQUEST)}),this.#pt.observe(this.#Xe)}get eventHandlers(){return{[g.AUTOCOMPLETE_BROADCAST]:this.#Et.bind(this),[g.COMMAND_EXECUTE_BROADCAST]:this.#St.bind(this)}}#Et(e){if(!this.#Xe)return;const{options:t=[],description:s,prefixLength:n}=e;if(this.#Xe.innerHTML="",s){const e=document.createElement("li");e.textContent=s,this.#Xe.appendChild(e),this.#Xe.setAttribute("prefix-length","0"),this.#Xe.removeAttribute("hidden")}else if(t.length>1){const e=document.createDocumentFragment();t.forEach((t,s)=>{const n=document.createElement("li");n.textContent=t,e.appendChild(n)}),this.#Xe.appendChild(e),this.#Xe.setAttribute("prefix-length",n),this.#Xe.removeAttribute("hidden")}else this.#Xe.setAttribute("hidden","")}#St(){this.#Xe&&(this.#Xe.setAttribute("hidden",""),this.#Xe.innerHTML="")}}function Ee(e){const{size:t,bgColor:s,symbolColor:n}=e,i=document.createElement("canvas");i.width=i.height=t;const a=i.getContext("2d"),r=Math.max(2,.15*t);a.roundRect(0,0,t,t,r),a.fillStyle=s,a.fill();const o=.3*t;a.beginPath(),a.arc(t/2,t/2,o,0,2*Math.PI),a.fillStyle=n,a.fill();const l=.22*t;return a.beginPath(),a.arc(.47*t,.39*t,l,0,2*Math.PI),"transparent"==s?(a.globalCompositeOperation="destination-out",a.fill(),a.globalCompositeOperation="source-over"):(a.fillStyle=s,a.fill()),i.toDataURL("image/png")}function Se(e){const{size:t,bgColor:s,symbolColor:n}=e,i=document.createElement("canvas");i.width=i.height=t;const a=i.getContext("2d"),r=Math.max(2,.15*t);a.roundRect(0,0,t,t,r),a.fillStyle=s,a.fill();const o=.2*t,l=o,c=t-o,h=o,d=t-o;return a.beginPath(),a.moveTo(h,l),a.lineTo(d,l),a.lineTo(h,c),a.lineTo(d,c),a.closePath(),a.fillStyle=n,a.fill(),i.toDataURL("image/png")}function ye(e){const{size:t,bgColor:s,symbolColor:n}=e,i=document.createElement("canvas");i.width=i.height=t;const a=i.getContext("2d"),r=Math.max(2,.15*t);a.roundRect(0,0,t,t,r),a.fillStyle=s,a.fill(),a.fillStyle=n,a.strokeStyle=n;const o=Math.max(1,.15*t);a.lineWidth=o;const l=.15*t;return a.beginPath(),a.arc(.35*t,.35*t,l,0,2*Math.PI),a.stroke(),a.beginPath(),a.moveTo(.45*t,.45*t),a.lineTo(.7*t,.7*t),a.lineTo(.6*t,.8*t),a.stroke(),i.toDataURL("image/png")}class Te extends p{static#yt=[16,32,64,128,180];#Xe=null;constructor(e){super(e),this.log.log("Initializing...")}setView(e){this.#Xe=e,this.log.log("View connected.")}get eventHandlers(){return{[g.THEME_CHANGED_BROADCAST]:this.#Tt.bind(this)}}#Tt(){if(!this.#Xe)return void this.log.warn("Cannot render favicon, view is not connected.");const e=getComputedStyle(this.#Xe),t={bgColor:e.getPropertyValue("--nnoitra-color-theme").trim()||"green",symbolColor:e.getPropertyValue("--nnoitra-color-text-highlight").trim()||"#000"};document.querySelectorAll("link[rel~='icon'], link[rel='apple-touch-icon']").forEach(e=>e.remove()),Te.#yt.forEach(e=>{const s=Ee({...t,size:e});this.log.log(s);const n=document.createElement("link");n.rel=180===e?"apple-touch-icon":"icon",n.type="image/png",n.sizes=`${e}x${e}`,n.href=s,document.head.appendChild(n)})}}class ve extends HTMLElement{#vt;#wt={};#n;get log(){return this.#n}constructor(e){super(),this.#n=d(this.constructor.name);const t=new CSSStyleSheet;if(t.replaceSync("\n      /* Styles for encapsulation and structural fundamentals remain here.\n       * The 'var()' function will look up the Custom Property\n       * (which pierces the Shadow DOM) from the :root or host element.\n       */\n\n      /* Good practice to add this for consistent box model */\n      * {\n        box-sizing: border-box;\n      }\n\n      /* Apply colors and font-family to the host to establish inheritance\n       * These custom properties should be defined at a higher level (e.g., :root or body).\n       */\n      :host {\n        font-family: var(--nnoitra-font-family);\n        color: var(--nnoitra-color-theme);\n        font-size: var(--nnoitra-font-size);\n      }\n      "),this.#vt=this.attachShadow({mode:"closed"}),this.#vt.adoptedStyleSheets=[t],e){const t=this.#ft(e);this.#vt.appendChild(t)}this.#Rt()}#Rt(){this.#vt.querySelectorAll("[part]").forEach(e=>{const t=e.getAttribute("part");this.log.log(`Mapping ref: "${t}" to element`,e),this.#wt[t]=e})}get refs(){return this.#wt}get shadowRoot(){return this.#vt}#ft(e){const t=document.createElement("template");return t.innerHTML=e,t.content}}const we=new CSSStyleSheet;we.replaceSync("\n:host {\n  height: 100%;\n  aspect-ratio: 1;\n  margin: 0;\n  padding: 0;\n}\n\n[part=symbol] {\n  font-family: var(--nnoitra-font-family);\n  font-size: inherit;\n  color: var(--nnoitra-color-text-highlight); /* VAR */\n  background-color: var(--nnoitra-color-highlight); /* VAR */\n  display: inline-flex;\n  justify-content: center; /* Center horizontally */\n  align-items: center;     /* Center vertically */\n  border-radius: 3px;\n  margin: 0;\n  min-width: 1.5em;\n  height: 100%;\n  width: 100%;\n  padding: 0;\n  padding-left: 0.2em;\n  padding-right: 0.2em;\n}\n\n[part=symbol-container] {\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  margin-right: 3px;\n  padding: 0;\n  height: 100%;\n  width: 100%;  \n}\n");class fe extends ve{#_t={ready:">",busy:"",key:""};static#At=[16,32,48,64];constructor(){super('<span part="symbol-container"></span>'),this.shadowRoot.adoptedStyleSheets=[...this.shadowRoot.adoptedStyleSheets,we],this.hasAttribute("type")||this.setAttribute("type","ready")}static get observedAttributes(){return["type","value"]}attributeChangedCallback(e,t,s){this.#bt()}#bt(){const e=this.getAttribute("type")||"ready",t=this.getAttribute("value"),s=this.refs["symbol-container"];switch(s.innerHTML="",e){case"busy":this.#Ct(s,Se);break;case"key":this.#Ct(s,ye);break;case"indexed":const e=document.createElement("span");e.part="symbol",e.textContent=`${t||""}:>`,s.appendChild(e);break;case"text":const n=document.createElement("span");n.part="symbol",n.textContent=t||"",s.appendChild(n);break;case"ready":this.#Ct(s,Ee)}}#Ct(e,t){const s={bgColor:"transparent",symbolColor:getComputedStyle(this).getPropertyValue("--nnoitra-color-text-highlight").trim()},n=document.createElement("img");n.part="symbol",n.style.padding="0",n.style.borderRadius="3px",n.src=Ee({...s,size:32}),n.srcset=fe.#At.map(e=>`${t({...s,size:e})} ${e}w`).join(", "),e.appendChild(n)}}customElements.define("nnoitra-icon",fe);const Re=new CSSStyleSheet;Re.replaceSync("\n:host {\n  --line-height: 2em;\n  --line-margin: 3px;\n  display: block;\n  margin: 0;\n  margin-top: var(--line-margin);\n  padding: 0;\n}\n\n[part=header],\n[part=icon],\n[part=command-container],\n[part=output] {\n  display: none;\n}\n\n:host(.header-visible) [part=header] {\n  display: block;\n}\n\n:host(.active) [part=output] {\n  display: block;\n  margin-top: var(--line-margin);\n}\n\n:host(.active) [part=command-container] {\n  display: flex; /* Ensure it's a flex container when active */\n}\n\n:host(.active) [part=icon] {\n  display: block; /* Make the icon visible when its container is active */\n}\n\n[part=icon] {\n  margin: 0;\n  padding: 0;\n  /* Other styling for the icon is handled by the nnoitra-icon component itself */\n}\n\n[part=command-container] {\n  align-items: center;\n  height: var(--line-height);\n  padding: 0; /* Match header's padding */\n  border-radius: 3px;\n  margin: 0;\n  margin-top: var(--line-margin);\n}\n\n[part=command] {\n  word-break: break-all;\n  white-space: pre-wrap;\n  align-items: center;\n  flex-grow: 1; /* Take up remaining space */\n  color: var(--nnoitra-color-text); /* VAR */\n  margin: 0;\n  padding: 0;\n  margin-left: 5px; /* Space between icon and command */\n\n}\n[part=header] {\n  flex-grow: 1; /* Take up remaining space */\n  min-height: var(--line-height);\n  line-height: var(--line-height);\n  align-items: center;     /* Center vertically */\n  color: var(--nnoitra-color-text-highlight); /* VAR */\n  background-color: var(--nnoitra-color-highlight); /* VAR */\n  padding: 0px 5px;\n  border-radius: 3px;\n  margin: 0px;\n  margin-top: var(--line-margin);\n}\n\n[part=header]::before {\n  content: '\\200b'; /* Zero-width space */\n  display: inline-block; /* Ensures it contributes to the line box */\n}\n[part=output] {\n  color: var(--nnoitra-color-output);\n  margin: 0;\n}\n\n[part=output] pre {\n  white-space: pre-wrap; /* Preserve whitespace but wrap long lines */\n  word-wrap: break-word; /* Ensure long words without spaces also break */\n  margin: 0; /* Reset default margins on pre for consistency */\n}\n");class _e extends ve{constructor(){super("\n  <div part='header'></div>\n  <div part='command-container'>\n  <nnoitra-icon part='icon'></nnoitra-icon>\n  <span part='command'></span>\n  </div>\n  <div part='output'><slot></slot></div>\n  "),this.shadowRoot.adoptedStyleSheets=[...this.shadowRoot.adoptedStyleSheets,Re]}static get observedAttributes(){return["item-id","header-text","command"]}attributeChangedCallback(e,t,s){if(t!==s)switch(e){case"item-id":this.id=`term-item-${s}`,this.hasAttribute("command")&&this.refs.icon.setAttribute("value",s);break;case"header-text":this.refs.header.textContent=s,this.classList.add("header-visible");break;case"command":this.refs.command.textContent=s;const e=this.getAttribute("item-id");e&&(this.refs.icon.setAttribute("type","indexed"),this.refs.icon.setAttribute("value",e)),this.classList.add("active")}}}customElements.define("nnoitra-term-item",_e);const Ae=window.location.hostname;class be extends p{static MOTD_FILE=new URL(x);#Xe=null;#Ot=1;#Ut=null;constructor(e){super(e),this.log.log("Initializing...")}setView(e){this.#Xe=e}get eventHandlers(){return{[g.VAR_UPDATE_DEFAULT_REQUEST]:this.#M.bind(this),[g.CLEAR_SCREEN_REQUEST]:this.#It.bind(this),[g.UI_SCROLL_TO_BOTTOM_REQUEST]:this.#Dt.bind(this),[g.COMMAND_EXECUTION_FINISHED_BROADCAST]:this.#Lt.bind(this)}}async start(){if(this.#Xe&&this.#Xe.welcomeOutputView)try{const e=await N(be.MOTD_FILE);console.log(e),this.#Xe.welcomeOutputView.style.whiteSpace="pre-wrap",this.#Xe.welcomeOutputView.textContent=e}catch(e){this.log.error("Failed to load motd.dat:",e)}this.#Lt()}#M({key:e,respond:t}){switch(e){case R.PS1:t({value:"[{year}-{month}-{day} {hour}:{minute}:{second}] {user}@{host}:{path}"});break;case R.HOST:t({value:Ae});break;case R.UUID:t({value:this.#Xe?.getAttribute("uuid")||"00000000-0000-0000-0000-000000000000"})}}#Nt(e){const t=e[R.PS1],s=new Date,n={user:e[R.USER],host:e[R.HOST],path:e[R.PWD],year:s.getFullYear(),month:String(s.getMonth()+1).padStart(2,"0"),day:String(s.getDate()).padStart(2,"0"),hour:String(s.getHours()).padStart(2,"0"),minute:String(s.getMinutes()).padStart(2,"0"),second:String(s.getSeconds()).padStart(2,"0")};return t.replace(/\{(\w+)\}/g,(e,t)=>n[t]??e)}#xt(e){const t=this.#Ot++,s=new _e;s.setAttribute("item-id",t),s.setAttribute("header-text",e),this.#Xe.appendToOutput(s),this.#Ut=s}async#Lt(){try{const[e,t,s,n]=await Promise.all([this.request(g.VAR_GET_USERSPACE_REQUEST,{key:R.PS1}),this.request(g.VAR_GET_LOCAL_REQUEST,{key:R.USER}),this.request(g.VAR_GET_TEMP_REQUEST,{key:R.HOST}),this.request(g.VAR_GET_TEMP_REQUEST,{key:R.PWD})]),i={PS1:e.value,USER:t.value,HOST:s.value,PWD:n.value},a=this.#Nt(i);this.#xt(a);const{value:r}=await this.#Pt();if(this.#Ut){this.#Ut.setAttribute("command",r);const e={element:this.#Ut};this.log.log(`Executing command: "${r}"`),this.#Xe.scrollToBottom(),this.dispatch(g.COMMAND_EXECUTE_BROADCAST,{commandString:r,outputElement:e})}}catch(e){this.log.error("Error in command loop:",e),this.dispatch(g.COMMAND_EXECUTION_FINISHED_BROADCAST)}}#It(){this.#Xe&&(this.#Xe.clearOutput(),this.#Ot=1)}#Dt(){this.#Xe&&this.#Xe.scrollToBottom()}#Pt(){return this.request(g.INPUT_REQUEST,{prompt:"",options:{allowHistory:!0,allowAutocomplete:!0,isSecret:!1}},0)}}function Ce(e){if(!e||0===e.length)return"";let t=e[0];for(let s=1;s<e.length;s++)for(;0!==e[s].indexOf(t);)if(t=t.substring(0,t.length-1),""===t)return"";return t}class Oe extends p{constructor(e){super(e),this.log.log("Initializing...")}get eventHandlers(){return{[g.AUTOCOMPLETE_REQUEST]:this.#kt.bind(this)}}async#kt({beforeCursorText:e,afterCursorText:t}){this.log.log("Autocomplete request received:",{beforeCursorText:e,afterCursorText:t});const s=D(e),n=s.pop();s.push("");let i=[],a="",r="",o=0;try{const e=await this.request(g.GET_AUTOCOMPLETE_SUGGESTIONS_REQUEST,{parts:s}),{suggestions:t}=e;if(r=e.description,t&&t.length>0){const e=t.filter(e=>e.startsWith(n));a=Ce(e),1===t.length&&t[0]===a?i=[]:(i=e,o=n.length)}else r&&(a=n,i=[])}catch(e){this.log.error("Error during autocomplete request:",e)}const l=a.substring(n.length);o+=l.length;const c={newTextBeforeCursor:e+l,options:i,afterCursorText:t,description:r,prefixLength:o};this.log.warn(c),this.dispatch(g.AUTOCOMPLETE_BROADCAST,c)}}const Ue=d("Media"),Ie=new CSSStyleSheet;Ie.replaceSync("\n  :host {\n    display: block; /* Ensures the host element takes up space */\n  }\n  .media {\n    /* Let the browser calculate width and height to preserve aspect ratio */\n    width: auto;\n    height: auto;\n    /* On larger screens, cap the width at a reasonable size (e.g., 80rem) */\n    /* Use min() to be responsive but also cap the width on large screens. */\n    max-width: min(100%, 80rem);\n    max-height: 80vh;\n    margin: 10px 0;\n    display: block; /* Helps with layout and margin */\n  }\n");class De extends ve{#Vt;constructor(){super(),this.shadowRoot.adoptedStyleSheets=[...this.shadowRoot.adoptedStyleSheets,Ie]}static get observedAttributes(){return["src"]}attributeChangedCallback(e,t,s){"src"===e&&t!==s&&(this.src=s)}set src(e){if(!e)return;this.#Vt&&this.#Vt.remove();if(/\.(png|jpg|jpeg|gif|webp)$/i.test(e))this.#Vt=document.createElement("img");else{if(!/\.(mp4|webm)$/i.test(e))return void Ue.error(`Unsupported file type for src: ${e}`);this.#Vt=document.createElement("video"),this.#Vt.controls=!0}this.#Vt.classList.add("media"),this.#Vt.src=e,this.shadowRoot.appendChild(this.#Vt)}get src(){return this.getAttribute("src")}}customElements.define("nnoitra-media",De);class Le extends p{constructor(e){super(e),this.log.log("Initializing...")}get eventHandlers(){return{[g.MEDIA_REQUEST]:this.#Mt.bind(this)}}#Mt({src:e,respond:t}){const s=new De;s.src=e;const n=new ResizeObserver(e=>{e[0].contentRect.height>1&&(this.dispatch(g.UI_SCROLL_TO_BOTTOM_REQUEST),n.disconnect())});n.observe(s),t({mediaElement:s})}}class Ne{#qt=new Map;async acquire(e,t){const s=this.#qt.get(e);if(t){if(s?.lockId&&s.lockId===t)return t;throw new Error(`Invalid lock ID '${t}' for operation on '${e}'. Current lock is '${s?.lockId}'.`)}{let t;const n=new Promise(e=>{t=e}),i=s?.promise||Promise.resolve();s?s.promise=n:this.#qt.set(e,{promise:n}),await i;const a=crypto.randomUUID(),r=this.#qt.get(e);return r.resolve=t,r.lockId=a,a}}release(e,t){const s=this.#qt.get(e);if(!s||s.lockId!==t)throw new Error(`Attempted to unlock '${e}' with an invalid or expired lockId.`);s.resolve()}}class xe extends p{static STORAGE_NAME="BASE";#Qt=new Ne;constructor(e){super(e),this.log.log(`Initializing ${this.constructor.STORAGE_NAME} storage service...`)}get eventHandlers(){return{[g.STORAGE_API_REQUEST]:this.#$t.bind(this)}}async#$t({storageName:e,api:t,data:s,respond:n}){if(e!==this.constructor.STORAGE_NAME)return;const{key:i,lockId:a}=s;if(!i)throw new Error(`A 'key' must be provided for any storage operation. API: ${t}`);let r,o;try{o=await this.#Qt.acquire(i,a),t===E.GET_NODE?r=await this.getNode(s):t===E.SET_NODE?r=await this.setNode(s):t===E.DELETE_NODE?r=await this.deleteNode(s):t===E.LIST_KEYS_WITH_PREFIX?r=await this.listKeysWithPrefix(s):t===E.LOCK_NODE&&(r={lockId:o})}finally{(t===E.UNLOCK_NODE||o&&!a&&t!==E.LOCK_NODE)&&this.#Qt.release(i,o)}n({result:r})}async getNode({key:e}){throw new Error(`${this.constructor.name} must implement the 'getNode' method.`)}async setNode({key:e,node:t}){throw new Error(`${this.constructor.name} must implement the 'setNode' method.`)}async deleteNode({key:e}){throw new Error(`${this.constructor.name} must implement the 'deleteNode' method.`)}async listKeysWithPrefix({key:e}){throw new Error(`${this.constructor.name} must implement the 'listKeysWithPrefix' method.`)}}class Pe extends xe{static STORAGE_NAME="LOCAL";#Ht="NNOITRA_LOCAL";constructor(e){super(e)}async getNode({key:e}){const t=await this.#Gt(e),s=localStorage.getItem(t);if(null!==s)try{return JSON.parse(s)}catch(e){return void this.log.error(`Failed to parse localStorage key ${t}:`,e)}}async setNode({key:e,node:t}){const s=await this.#Gt(e);try{localStorage.setItem(s,JSON.stringify(t))}catch(e){throw this.log.error(`Failed to write to localStorage for key ${s}:`,e),e}}async deleteNode({key:e}){const t=await this.#Gt(e);localStorage.removeItem(t)}async listKeysWithPrefix({key:e}){const t=await this.#Gt(e),s=[];for(let n=0;n<localStorage.length;n++){const i=localStorage.key(n);i.startsWith(t)&&s.push(i.substring(t.length-e.length))}return s}async#Gt(e){const{value:t}=await this.request(g.VAR_GET_TEMP_REQUEST,{key:R.UUID});return`${this.#Ht}_${t}_${e}`}}class ke extends xe{static STORAGE_NAME="SESSION";#Ft=new Map;#Bt=new Set;constructor(e){super(e),this.#Bt.add("/")}async listPath({path:e}){const t="/"===e?"":e,s=t?t+"/":"/",n=[],i=new Set;for(const e of this.#Ft.keys())if(e.startsWith(s)){const t=e.substring(s.length);t.includes("/")||n.push({name:t,size:this.#Ft.get(e).length})}for(const t of this.#Bt)if(t.startsWith(s)&&t!==e){const e=t.substring(s.length).split("/")[0];e&&i.add(e)}return{files:n,directories:Array.from(i).map(e=>({name:e}))}}async readFile({path:e}){if(!this.#Ft.has(e))throw new Error("File not found.");return this.#Ft.get(e)}async writeFile({path:e,content:t}){const s=e.substring(0,e.lastIndexOf("/"))||"/";this.#Yt(s),this.#Ft.set(e,t)}async deleteFile({path:e}){if(!this.#Ft.has(e))throw new Error("File not found.");this.#Ft.delete(e)}async makeDirectory({path:e}){this.#Yt(e)}async removeDirectory({path:e}){const t="/"===e?"/":e+"/";for(const e of this.#Ft.keys())e.startsWith(t)&&this.#Ft.delete(e);for(const t of this.#Bt)t.startsWith(e)&&this.#Bt.delete(t)}async getMetaData({path:e}){return{path:e,isFile:this.#Ft.has(e),isDirectory:this.#Bt.has(e),publicUrl:null}}#Yt(e){const t=e.split("/").filter(e=>e);let s="";for(const e of t)s+="/"+e,this.#Bt.add(s)}}class Ve{constructor(e={}){const t=new m;this.services={bus:t,environment:v.create(t),accounting:C.create(t,{apiUrl:e.accountingApi}),history:U.create(t),command:le.create(t),theme:me.create(t),input:ge.create(t),hint:pe.create(t),favicon:Te.create(t),terminal:be.create(t),filesystem:he.create(t,{apiUrl:e.filesystemApi}),autocomplete:Oe.create(t),media:Le.create(t),localStorage:Pe.create(t),sessionStorage:ke.create(t)}}}const Me=new CSSStyleSheet;Me.replaceSync("\n[part=footer] {\n  margin: 0;\n  padding: 3px;\n  display: flex;\n  align-items: stretch; /* Change to stretch */\n  border-top: 1px solid var(--nnoitra-color-highlight); /* VAR */\n  background-color: var(--nnoitra-color-background); /* VAR */\n  box-sizing: border-box;\n  z-index: 100;\n  font-size: var(--nnoitra-font-size);\n  height: 2.2em;\n}\n[part=prompt] {\n  background: none;\n  border: none;\n  outline: none;\n  padding: 0;\n  padding-left: 0.5em;\n  padding-right: 0.5em;\n  margin: 0;\n  flex-grow: 1;\n  color: var(--nnoitra-color-theme); /* VAR */\n  min-width: 0; /* Prevents overflow in flex container */\n  flex-grow: 1;\n  font-family: var(--nnoitra-font-family);\n  font-size: var(--nnoitra-font-size);\n  width: 100%;\n}\n[part=prompt]::placeholder {\n  color: var(--nnoitra-color-placeholder);\n  font-family: var(--nnoitra-font-family);\n  font-size: var(--nnoitra-font-size);\n  opacity: 1; /* Firefox has a lower default opacity for placeholders */\n  width: 100%;\n}\n\n[part=icon] {\n  height: 100%;\n  aspect-ratio: 1;\n  margin: 0;\n  padding: 0;\n}\n");customElements.define("nnoitra-cmd",class extends ve{#tt=!1;#zt="";#jt=!0;#Kt=0;#Wt=0;constructor(){super('\n  <div part="footer">\n  <nnoitra-icon part="icon"></nnoitra-icon>\n  <input type="text" autocomplete="off" spellcheck="false" autocapitalize="off" part="prompt">\n  </div>\n  '),this.shadowRoot.adoptedStyleSheets=[...this.shadowRoot.adoptedStyleSheets,Me],this.refs.footer.addEventListener("touchstart",this.#Xt.bind(this),{passive:!0}),this.refs.footer.addEventListener("touchend",this.#Jt.bind(this),{passive:!0}),this.refs.prompt.addEventListener("input",this.#Zt.bind(this)),this.refs.prompt.addEventListener("keydown",this.#es.bind(this))}static get observedAttributes(){return["disabled","secret","placeholder","icon-text"]}attributeChangedCallback(e,t,s){switch(e){case"disabled":this.#jt=!this.hasAttribute("disabled"),this.#jt&&!this.#tt?this.#ts():this.#jt||this.#ss();break;case"secret":this.#tt=this.hasAttribute("secret"),this.#tt?this.#ns():this.#ts();break;case"placeholder":this.refs.prompt.placeholder=s||"";break;case"icon-text":null!==s?(this.refs.icon&&this.refs.icon.setAttribute("type","text"),this.refs.icon&&this.refs.icon.setAttribute("value",s)):this.#tt?this.#ns():this.#ts()}}#Zt(e){if(!this.#tt)return;const t=this.refs.prompt,s=this.#zt,n=t.value,i=t.selectionStart,a=s.length-(n.length-(e.data?e.data.length:0)),r=i-(e.data?e.data.length:0),o=s.slice(0,r),l=s.slice(r+a),c=o+(e.data||"")+l;this.#zt=c,requestAnimationFrame(()=>{t.value="".repeat(this.#zt.length),t.setSelectionRange(i,i)})}#es(e){if(!this.#jt)return e.preventDefault(),void e.stopPropagation();"Enter"===e.key?(e.preventDefault(),this.#is("enter",{value:this.getValue()})):"Tab"===e.key?(e.preventDefault(),this.#is("tab")):"ArrowUp"===e.key?(e.preventDefault(),this.#is("arrow-up")):"ArrowDown"===e.key&&(e.preventDefault(),this.#is("arrow-down"))}#Xt(e){const t=e.touches[0];t&&(this.#Kt=t.clientX,this.#Wt=t.clientY)}#Jt(e){const t=e.changedTouches[0];if(0===this.#Kt||!t)return;const s=t.clientX-this.#Kt,n=t.clientY-this.#Wt;s>50&&Math.abs(n)<50&&this.#is("swipe-right")}#is(e,t={}){this.dispatchEvent(new CustomEvent(e,{bubbles:!0,composed:!0,detail:t}))}focus(){this.refs.prompt.focus()}getValue(){return this.#tt?this.#zt:this.refs.prompt.value}setValue(e){this.#tt?(this.#zt=e,this.refs.prompt.value="".repeat(e.length)):this.refs.prompt.value=e}getCursorPosition(){return this.refs.prompt.selectionStart}setCursorPosition(e){this.refs.prompt.setSelectionRange(e,e)}clear(){this.refs.prompt.value="",this.#zt=""}#ts(){this.refs.icon&&this.refs.icon.setAttribute("type","ready")}#ss(){this.refs.icon&&this.refs.icon.setAttribute("type","busy")}#ns(){this.refs.icon&&this.refs.icon.setAttribute("type","key")}});d("HintBox");const qe=new CSSStyleSheet;qe.replaceSync("\n:host([hidden]) {\n  display: none;\n}\n\n[part=box] {\n  color: var(--nnoitra-color-theme); /* VAR */\n  background-color: var(--nnoitra-color-background); /* VAR */\n  display: flex;\n  flex-direction: row;\n  flex-wrap: wrap;\n  list-style: none;\n  width: 100%;\n  margin: 0;\n  border-left: 3px solid var(--nnoitra-color-highlight);\n  padding: 5px 0 0 10px;\n}\n\n[part=box] li {\n  flex-shrink: 1;\n  margin-right: 1em;\n  margin-bottom: 0.5em;\n  min-width: 0;\n  white-space: normal;\n  overflow-wrap: break-word;\n  opacity: 0;\n  transform: translateY(-5px);\n  transition: opacity 0.2s ease-out, transform 0.2s ease-out;\n}\n\n[part=box] li.visible {\n  opacity: 1;\n  transform: translateY(0);\n}\n\n.prefix {\n  color: var(--nnoitra-color-muted);\n}\n\n.suffix {\n  font-weight: bold;\n}\n");customElements.define("nnoitra-hint-box",class extends ve{constructor(){super('\n  <ul part="box"></ul>\n  <slot hidden></slot>\n'),this.shadowRoot.adoptedStyleSheets=[...this.shadowRoot.adoptedStyleSheets,qe];this.shadowRoot.querySelector("slot").addEventListener("slotchange",()=>this.#bt())}static get observedAttributes(){return["hidden","prefix-length"]}attributeChangedCallback(e,t,s){this.#bt()}#bt(){const e=this.refs.box;if(e.innerHTML="",this.hasAttribute("hidden"))return;const t=parseInt(this.getAttribute("prefix-length")||"0",10),s=this.querySelectorAll("li");if(0===s.length)return;const n=document.createDocumentFragment();s.forEach((e,s)=>{const i=e.textContent||"",a=document.createElement("li"),r=document.createElement("span"),o=document.createElement("span");r.className="prefix",r.textContent=i.substring(0,t),o.className="suffix",o.textContent=i.substring(t),a.appendChild(r),a.appendChild(o),n.appendChild(a),setTimeout(()=>a.classList.add("visible"),50*s)}),e.appendChild(n)}});const Qe=d("Terminal");var $e;$e=t("euAS4");const He=new URL($e);var Ge;Ge=t("4acmQ");const Fe=new URL(Ge);var Be;Be=t("jRB9m");const Ye=new URL(Be);var ze;ze=t("6rugH");const je=new URL(ze),Ke=new CSSStyleSheet;Ke.replaceSync("\n:host {\n  /* Default Theme & Font Variables */\n  --nnoitra-color-green: #5CB338;\n  --nnoitra-color-yellow: #ECE852;\n  --nnoitra-color-orange: #FFC145;\n  --nnoitra-color-red: #FB4141;\n  --nnoitra-color-black: #000000;\n  --nnoitra-color-white: #FFFFFF;\n  --nnoitra-color-theme: var(--nnoitra-color-green);\n  --nnoitra-color-muted: color-mix(in srgb, var(--nnoitra-color-theme), black 40%);\n  --nnoitra-color-placeholder: var(--nnoitra-color-muted);\n  --nnoitra-color-output: var(--nnoitra-color-white);\n  --nnoitra-color-highlight: var(--nnoitra-color-theme);\n  --nnoitra-color-text-highlight: var(--nnoitra-color-black);\n  --nnoitra-font-family: 'Ubuntu Mono', Menlo, Consolas, 'Liberation Mono', 'Courier New', monospace;\n  --nnoitra-font-size: clamp(0.9rem, 3vw, 1.2rem);\n\n\n  /* Default Layout & Appearance */\n  display: flex;\n  flex-direction: column;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  background-color: var(--nnoitra-color-black);\n  color: var(--nnoitra-color-theme);\n  font-size: var(--nnoitra-font-size);\n  font-family: var(--nnoitra-font-family);\n}\n\n/* Styles for links injected by commands like 'about' */\na {\n    color: var(--nnoitra-color-theme);\n    text-decoration: none; /* Remove underline for a cleaner look */\n}\n\n/* Styles for 'about' command content */\n.about-title {\n    font-weight: bold;\n}\n\n[part=terminal] {\n  flex: 1;\n  overflow-y: auto;\n  padding: 10px;\n  box-sizing: border-box;\n  display: flex;\n  flex-direction: column;\n  scroll-behavior: smooth;\n  height: 100%;\n  width: 100%;\n}\n[part=prompt] {\n  flex-shrink: 0;\n}\n\n[part=terminal] [part=hint] {\n  padding: 0;\n  margin: 0;\n  margin-top: 6px;\n}\n\n");customElements.define("nnoitra-terminal",class extends ve{#pt;#as;#X;constructor(){super('\n  <div part="terminal">\n  <div part="welcome-output"></div>\n  <div part="output"></div>\n  <nnoitra-hint-box part="hint" hidden></nnoitra-hint-box>\n  </div>\n  <nnoitra-cmd part="prompt"></nnoitra-cmd>\n  '),this.#rs(He,{weight:"normal"}),this.#rs(Fe,{weight:"bold"}),this.#rs(Ye,{weight:"normal",style:"italic"}),this.#rs(je,{weight:"bold",style:"italic"}),this.shadowRoot.adoptedStyleSheets=[...this.shadowRoot.adoptedStyleSheets,Ke]}static get observedAttributes(){return["autofocus","filesystem-api","accounting-api"]}get promptView(){return this.refs.prompt}get hintView(){return this.refs.hint}get welcomeOutputView(){return this.refs["welcome-output"]}#os(){const e={filesystemApi:this.getAttribute("filesystem-api"),accountingApi:this.getAttribute("accounting-api")},t=new Ve(e);this.#X=t.services,this.#X.input.setView(this.promptView),this.#X.hint.setView(this.hintView),this.#X.terminal.setView(this),this.#X.theme.setView(this),this.#X.favicon.setView(this),this.#ls(),Qe.log("Terminal bootstrapped successfully.")}#rs(e,t={}){const{weight:s="normal",style:n="normal"}=t,i=new FontFace("Ubuntu Mono",`url(${e.href})`,{weight:s,style:n,display:"swap"});i.load().then(()=>{document.fonts.add(i),this.log.log(`Font loaded: Ubuntu Mono ${s} ${n}`)}).catch(e=>{this.log.error(`Failed to load font: Ubuntu Mono ${s} ${n}`,e)})}#ls(){this.tabIndex=0,this.addEventListener("focus",this.setFocus),this.refs.terminal.addEventListener("click",this.#cs.bind(this))}connectedCallback(){this.#os(),this.#pt=new ResizeObserver(()=>{this.scrollToBottom()}),this.#pt.observe(this.refs.terminal),this.#as=new MutationObserver(()=>this.scrollToBottom()),this.#as.observe(this.refs.terminal,{childList:!0,subtree:!0}),Object.values(this.#X).forEach(e=>{e&&"function"==typeof e.start&&e.start()})}disconnectedCallback(){this.#pt&&this.#pt.disconnect(),this.#as&&this.#as.disconnect()}attributeChangedCallback(e){"autofocus"===e&&this.hasAttribute("autofocus")&&this.setFocus()}#cs(e){e.target===this.refs.terminal&&this.setFocus()}appendToOutput(e){this.refs.output.appendChild(e)}clearOutput(){this.refs.output&&(this.refs.output.innerHTML="")}setFocus(){this.promptView.focus()}scrollToBottom(){requestAnimationFrame(()=>{this.refs.terminal.scrollTop=this.refs.terminal.scrollHeight})}})})();