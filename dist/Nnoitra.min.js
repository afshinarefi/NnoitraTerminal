(()=>{function e(e){if(e=a.i?.[e]||e,!t)try{throw Error()}catch(n){var s=(""+n.stack).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/[^)\n]+/g);if(!s)return i+e;t=s[0]}return new URL(i+e,t).toString()}var t,s=globalThis,i="./",n={},r={},a=s.parcelRequire166b;null==a&&((a=function(e){if(e in n)return n[e].exports;if(e in r){var t=r[e];delete r[e];var s={id:e,exports:{}};return n[e]=s,t.call(s.exports,s,s.exports),s.exports}var i=Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(e,t){r[e]=t},s.parcelRequire166b=a),a.register,Object.assign(a.i??={},{cdQpk:"motd.6d76bb23.txt","6eguK":"version.a151142a.txt",h1BFt:"UbuntuMono-R.54fdcd79.ttf",h01Zq:"UbuntuMono-B.1f21d913.ttf",lAJo3:"UbuntuMono-RI.0df7809e.ttf",dYGdR:"UbuntuMono-BI.2127d1cf.ttf"});let o=new Map([["EventBus",!0],["EnvironmentService",!0],["AccountingService",!0],["CommandService",!0],["FilesystemService",!0],["HistoryService",!0],["HintService",!0],["InputService",!0],["TerminalService",!0],["ThemeService",!0],["FaviconService",!0],["LocalStorageService",!0],["AutocompleteService",!0],["TerminalPrompt",!1],["TerminalSymbol",!1],["HintBox",!1],["Terminal",!1],["CommandBlock",!1],["login",!1],["logout",!1],["ls",!1],["cat",!1],["env",!0],["history",!1],["history",!0],["cd",!0],["view",!0]]),l=()=>{},h=new Map;function c(e){if(h.has(e))return h.get(e);let t=o.get(e)||!1,s={log:t?console.log.bind(console,`[${e}]`):l,warn:t?console.warn.bind(console,`[${e}]`):l,error:t?console.error.bind(console,`[${e}]`):l};return h.set(e,s),s}let d=c("EventBus");class u{#e=new Map;#t=new Map;constructor(){d.log("Initializing...")}listen(e,t,s="anonymous"){this.#e.has(e)||this.#e.set(e,[]),this.#e.get(e).push({callback:t,name:s})}dispatch(e,t){d.log(`Dispatching event "${e}" with payload: ${JSON.stringify(t)}`),this.#e.has(e)&&Promise.resolve().then(async()=>{let s=this.#e.get(e);s&&s.forEach(s=>{d.log(`Dispatching event "${e}" to listener "${s.name}"`),Promise.resolve().then(()=>s.callback(t))})})}request(e,t={},s=6e3){let i=`${e}-${Date.now()}-${Math.random()}`;return new Promise((n,r)=>{this.#t.set(i,{resolve:n,reject:r});let a=null;s>0&&(a=setTimeout(()=>{this.#t.has(i)&&(this.#t.get(i).reject(Error(`Request timed out for event "${e} with payload: ${JSON.stringify(t)}"`)),this.#t.delete(i))},s));let o={...t,respond:t=>!!this.#t.has(i)&&(a&&clearTimeout(a),d.log(`Response received for event "${e}": ${JSON.stringify(t)}`),this.#t.get(i).resolve(t),this.#t.delete(i),!0)};this.dispatch(e,o)})}}let m="get-all-categorized-vars-request",p="variable-get-local-request",g="variable-get-system-request",y="variable-get-temp-request",f="variable-get-userspace-request",v="variable-set-local-request",w="variable-set-system-request",b="variable-set-temp-request",S="variable-set-userspace-request",x="variable-delete-local-request",C="variable-delete-userspace-request",E="load-local-variable",A="save-local-variable",T="delete-local-variable",k="variable-update-default-request",I="user-changed-broadcast",M="login-request",P="logout-request",$="password-change-request",O="add-user-request",q="is-logged-in-request",N="variable-save-remote-request",R="variable-load-remote-request",D="variable-delete-remote-request",L="history-previous-request",V="history-next-request",U="history-indexed-response",F="history-load-request",z="history-get-all-request",j="command-persist-request",H="command-execute-broadcast",_="command-execution-finished-broadcast",Y="autocomplete-request",B="autocomplete-broadcast",W="get-autocomplete-suggestions-request",J="get-aliases-request",X="set-aliases-request",G="get-command-list-request",Q="get-command-meta-request",Z="input-request",K="clear-screen-request",ee="theme-changed-broadcast",te="ui-scroll-to-bottom-request",se="set-theme-request",ie="get-valid-themes-request",ne="media-request",re="fs-change-directory-request",ae="fs-get-directory-contents-request",oe="fs-get-file-contents-request",le="fs-get-public-url-request",he="fs-resolve-path-request";class ce{#s;#i;constructor(e){if(!e)throw Error("BaseService requires an eventBus.");this.#s=e,this.#i=c(this.constructor.name),this.log.log("Initializing...")}static create(e,t={}){let s=new this(e,t);return s.#n(),s}start(){}get log(){return this.#i}dispatch(e,t={}){this.#s.dispatch(e,t)}request(e,t,s=0){return this.#s.request(e,t,s)}get eventHandlers(){return{}}#n(){for(let[e,t]of Object.entries(this.eventHandlers))this.#s.listen(e,t,this.constructor.name)}}let de="SYSTEM",ue="USERSPACE";class me extends ce{#r=new Map;constructor(e){super(e),this.log.log("Initializing...")}get eventHandlers(){return{[m]:this.#a.bind(this),[I]:this.#o.bind(this),[p]:this.#l.bind(this),[g]:this.#h.bind(this),[y]:this.#c.bind(this),[f]:this.#d.bind(this),[v]:this.#u.bind(this),[w]:this.#m.bind(this),[b]:this.#p.bind(this),[S]:this.#g.bind(this),[x]:this.#y.bind(this),"variable-delete-system-request":this.#f.bind(this),"variable-delete-temp-request":this.#v.bind(this),[C]:this.#w.bind(this)}}start(){}async#c({key:e,respond:t}){let s=e.toUpperCase(),i=this.#r.get(s);void 0===i&&(this.log.log(`Temp variable "${s}" is undefined, requesting its default value.`),void 0!==(i=(await this.request(k,{key:s})).value)&&this.#b(s,i)),t({value:i})}async#l({key:e,respond:t}){let s=e.toUpperCase(),{value:i}=await this.request(E,{key:s,namespace:"ENV"}),n=i;void 0===n&&(this.log.log(`Local variable "${s}" is undefined, requesting its default value.`),void 0!==(n=(await this.request(k,{key:s})).value)&&this.#S(s,n)),t({value:n})}async#d({key:e,respond:t}){return this.#x({key:e,respond:t},ue)}async#h({key:e,respond:t}){return this.#x({key:e,respond:t},de)}async#x({key:e,respond:t},s){let i,n=e.toUpperCase(),{variables:r}=await this.request(R,{key:n,category:s});void 0===(i=r?r[n]:void 0)&&(this.log.log(`Remote/Userspace variable "${n}" is undefined, requesting its default value.`),void 0!==(i=(await this.request(k,{key:n})).value)&&this.#C(n,i,s)),t({value:i})}#p({key:e,value:t}){this.#b(e.toUpperCase(),t)}#u({key:e,value:t}){this.#S(e.toUpperCase(),t)}#m({key:e,value:t}){this.#C(e.toUpperCase(),t,de)}#g({key:e,value:t}){this.#C(e.toUpperCase(),t,ue)}#v({key:e}){this.#E(e.toUpperCase())}#y({key:e}){this.#A(e.toUpperCase())}#f({key:e}){this.#T(e.toUpperCase(),de)}#w({key:e}){this.#T(e.toUpperCase(),ue)}#k(e,t){return"number"==typeof t&&(t=String(t)),!!e&&(null===t||"string"==typeof t)||(this.log.error("Invalid key or value provided to setVariable:",{key:e,value:t,type:typeof t}),!1)}#b(e,t){this.#k(e,t)&&this.#r.set(e,t)}#S(e,t){this.#k(e,t)&&this.dispatch(A,{key:e,value:t,namespace:"ENV"})}#C(e,t,s){this.#k(e,t)&&this.dispatch(N,{key:e,value:t,category:s})}#E(e){this.#r.delete(e)}#A(e){this.dispatch(T,{key:e,namespace:"ENV"})}#T(e,t){this.dispatch(D,{key:e,category:t})}async#o(){this.#r.clear()}#a({respond:e}){(async()=>{let t={TEMP:{},LOCAL:{},SYSTEM:{},USERSPACE:{}};t.TEMP=Object.fromEntries(this.#r),t.LOCAL=(await this.request(E,{namespace:"ENV"})).value;let{variables:s}=await this.request(R,{category:[de,ue]});Object.assign(t.SYSTEM,s.SYSTEM||{}),Object.assign(t.USERSPACE,s.USERSPACE||{}),e({categorized:t})})()}}let pe=c("ApiManager");class ge{#I;constructor(e){this.#I=e}async post(e,t={},s=null){let i=new FormData;for(let[e,n]of(s&&i.append("token",s),Object.entries(t)))i.append(e,n);pe.log(`Making API call: action=${e}`);let n=await fetch(`${this.#I}?action=${e}`,{method:"POST",body:i});if(!n.ok)throw Error(`API request failed with status ${n.status}: ${n.statusText}`);let r=n.headers.get("content-type");if(!r||!r.includes("application/json"))throw Error(`Invalid response from server: Expected JSON but received ${r}. Is the server running with the --cgi flag?`);return n.json()}async get(e={}){let t=new URL(this.#I,window.location.origin);for(let[s,i]of Object.entries(e))t.searchParams.append(s,i);pe.log(`Making API call (GET): url=${t}`);let s=await fetch(t,{method:"GET"});if(!s.ok)throw Error(`API request failed with status ${s.status}: ${s.statusText}`);let i=s.headers.get("content-type");if(!i||!i.includes("application/json"))throw Error(`Invalid response from server: Expected JSON but received ${i}. Is the server running with the --cgi flag?`);return s.json()}}let ye="HOST",fe="USER",ve="HISTSIZE",we="ALIAS",be="TOKEN",Se="TOKEN_EXPIRY",xe="guest",Ce="GUEST_STORAGE_",Ee="HISTORY";class Ae extends ce{#M;constructor(e,t={}){super(e),this.#M=new ge(t.apiUrl),this.log.log("Initializing...")}get eventHandlers(){return{[N]:this.#P.bind(this),[j]:this.#$.bind(this),[F]:this.#O.bind(this),[M]:this.#q.bind(this),[P]:this.#N.bind(this),[$]:this.#R.bind(this),[O]:this.#D.bind(this),[k]:this.#L.bind(this),[R]:this.#V.bind(this),[D]:this.#U.bind(this),[q]:this.#F.bind(this)}}async isLoggedIn(){let{value:e}=await this.request(p,{key:be});return!!e}async start(){this.dispatch(I)}async login(e,t){try{this.log.log(`Attempting login for user: "${e}"`);let s=await this.#M.post("login",{username:e,password:t},null);return"success"===s.status&&(this.log.log("Login successful. Setting session variables."),this.dispatch(v,{key:be,value:s.token}),this.dispatch(v,{key:fe,value:s.user}),this.dispatch(v,{key:Se,value:s.expires_at}),this.dispatch(I)),s}catch(e){return this.log.error("Network or parsing error during login:",e),{status:"error",message:`Error: ${e.message}`}}}async logout(){try{let{value:e}=await this.request(p,{key:be}),t=await this.#M.post("logout",{},e);return("success"===t.status||"error"===t.status&&t.message.includes("expired"))&&(this.dispatch(x,{key:be}),this.dispatch(v,{key:fe,value:xe}),this.dispatch(x,{key:Se}),this.dispatch(I)),t}catch(e){return this.log.error("Network or parsing error during logout:",e),{status:"error",message:`Error: ${e.message}`}}}async#q({username:e,password:t,respond:s}){s(await this.login(e,t))}async#N({respond:e}){e(await this.logout())}async#z(e,t){try{return await this.#M.post("add_user",{username:e,password:t})}catch(e){return this.log.error("Network or parsing error during user creation:",e),{status:"error",message:`Error: ${e.message}`}}}async#D({username:e,password:t,respond:s}){s(await this.#z(e,t))}async#j(e,t){let{value:s}=await this.request(p,{key:be});if(!s)return{status:"error",message:"Not logged in."};try{return this.log.log("Attempting password change..."),this.log.log("Old password:",e),this.log.log("New password:",t),await this.#M.post("change_password",{old_password:e,new_password:t},s)}catch(e){return this.log.error("Network or parsing error during password change:",e),{status:"error",message:`Error: ${e.message}`}}}async#R({oldPassword:e,newPassword:t,respond:s}){s(await this.#j(e,t))}async#F({respond:e}){e({isLoggedIn:await this.isLoggedIn()})}#L({key:e,respond:t}){switch(e){case fe:t({value:xe});break;case be:t({value:""})}}async#P(e){let{value:t}=await this.request(p,{key:fe});if(t===xe)this.dispatch(A,{namespace:`${Ce}${e.category}`,key:e.key,value:e.value});else{let{value:t}=await this.request(p,{key:be});this.#M.post("set_data",{category:e.category,key:e.key,value:e.value},t)}}async#U(e){let{value:t}=await this.request(p,{key:fe});if(t===xe)this.dispatch(T,{namespace:`${Ce}${e.category}`,key:e.key});else{let{value:t}=await this.request(p,{key:be});this.#M.post("delete_data",{category:e.category,key:e.key},t)}}async#$(e){let{value:t}=await this.request(p,{key:fe});if(t===xe)this.dispatch(A,{namespace:`${Ce}${Ee}`,key:Date.now(),value:e.command});else{let{value:t}=await this.request(p,{key:be});this.#M.post("set_data",{category:Ee,key:Date.now(),value:e.command},t)}}async#O({respond:e}){let{value:t}=await this.request(p,{key:fe});if(t===xe){let{value:t}=await this.request(E,{namespace:`${Ce}${Ee}`});e&&e({history:t||{}})}else try{let{value:t}=await this.request(p,{key:be}),s=await this.#M.post("get_data",{category:Ee},t);this.log.log("History data received from server:",s),e&&e({history:s.data||[]})}catch(t){this.log.error("Failed to load history from server:",t),e&&e({history:[],error:t})}}async#V({key:e,category:t,respond:s}){let{value:i}=await this.request(p,{key:fe});if(i===xe){let i={};for(let s of Array.isArray(t)?t:[t]){let n=`${Ce}${s}`,{value:r}=await this.request(E,{namespace:n,key:e});void 0!==e?void 0!==r&&(i[e]=r):Array.isArray(t)?i[s]=r||{}:Object.assign(i,r||{})}s&&s({variables:i})}else try{let{value:i}=await this.request(p,{key:be}),n=await this.#M.post("get_data",{category:t,key:e},i);this.log.log("Remote variables received from server:",n),s&&s({variables:n.data||{}})}catch(e){this.log.error("Failed to load remote variables from server:",e),s&&s({variables:{},error:e})}}}let Te="1000";class ke extends ce{#H=[];#_=0;#Y=parseInt(Te,10);constructor(e){super(e),this.log.log("Initializing...")}get eventHandlers(){return{[L]:this.#B.bind(this),[V]:this.#W.bind(this),[H]:this.#J.bind(this),[z]:this.#X.bind(this),[k]:this.#L.bind(this),[I]:this.#o.bind(this)}}#J({commandString:e}){this.addCommand(e)}#L({key:e,respond:t}){e===ve&&t({value:Te})}async#o(){let{history:e}=await this.request(F);this.loadHistory(e)}#G(e){let t=parseInt(e,10);!isNaN(t)&&t>=0?this.#Y=t:(this.log.warn(`Invalid HISTSIZE value "${e}". Resetting to default: ${Te}`),this.#Y=parseInt(Te,10))}async addCommand(e){let t=e.trim();if(!t||this.#H.length>0&&this.#H[0]===t)return;this.#H.unshift(t),this.dispatch(j,{command:t});let{value:s}=await this.request(g,{key:ve});this.#G(s||Te),this.#H.length>this.#Y&&this.#H.pop(),this.resetCursor()}resetCursor(){this.#_=0}#B(){this.#_<this.#H.length&&this.#_++;let e={command:this.#H[this.#_-1]||"",index:this.#_};this.dispatch(U,e)}#W(){this.#_>0&&this.#_--;let e={command:this.#H[this.#_-1]||"",index:this.#_};this.dispatch(U,e)}#X({respond:e}){e({history:this.#H.slice().reverse()})}loadHistory(e){if(e){let t=Object.keys(e).sort().map(t=>e[t]);this.#H=t.reverse(),this.resetCursor(),this.log.log(`Loaded ${this.#H.length} commands into history.`)}}clearHistory(){this.#H=[],this.resetCursor()}}c("ServiceApiManager");class Ie{#s;constructor(e){this.#s=e}async prompt(e,t={}){return(await this.#s.request(Z,{prompt:e,options:t},0)).value}clearScreen(){this.#s.dispatch(K)}scrollToBottom(){this.#s.dispatch(te)}async requestMedia(e){return(await this.#s.request(ne,{src:e})).mediaElement}async login(e,t){return await this.#s.request(M,{username:e,password:t})}async logout(){return await this.#s.request(P,{})}async changePassword(e,t){return await this.#s.request($,{oldPassword:e,newPassword:t})}async addUser(e,t){return await this.#s.request(O,{username:e,password:t})}async isLoggedIn(){return(await this.#s.request(q,{})).isLoggedIn}async isDirectory(e){return(await this.#s.request("fs-is-directory-request",{path:e})).isDirectory}async getDirectoryContents(e){let t=await this.#s.request(ae,{path:e});if(t.error)throw Error(t.error.message||"Failed to get directory contents.");return t.contents}async getFileContents(e){let t=await this.#s.request(oe,{path:e});if(t.error)throw Error(t.error.message||"Failed to get file contents.");return t.contents}async getPublicUrl(e){return(await this.#s.request(le,{path:e})).url}async resolvePath(e,t=!1){let s=await this.#s.request(he,{path:e,mustBeDir:t});if(s.error)throw s.error;return s.path}async getHistory(){return(await this.#s.request(z,{})).history}async changeDirectory(e){let t=await this.#s.request(re,{path:e});if(t.error)throw t.error}setTempVariable(e,t){this.#s.dispatch(b,{key:e,value:t})}setLocalVariable(e,t){this.#s.dispatch(v,{key:e,value:t})}setSystemVariable(e,t){this.#s.dispatch(w,{key:e,value:t})}async getSystemVariable(e,t){return await this.#s.request(g,{key:e})}setUserspaceVariable(e,t){this.#s.dispatch(S,{key:e,value:t})}deleteUserspaceVariable(e){this.#s.dispatch(C,{key:e})}async getAllCategorizedVariables(){let{categorized:e}=await this.#s.request(m,{});return e}async getAliases(){return(await this.#s.request(J,{})).aliases}setAliases(e){this.#s.dispatch(X,{aliases:e})}async getCommandList(){return(await this.#s.request(G,{})).commands}async getCommandMeta(e,t){return(await this.#s.request(Q,{commandName:e,metaKey:t})).value}async setTheme(e){return(await this.#s.request(se,{themeName:e})).theme}async getValidThemes(){return(await this.#s.request(ie,{})).themes}}function Me(e){let t=[],s=[" ","/","="],i=["'",'"'],n=["\\"],r="",a=null,o=!1,l=(e="")=>{t.push(r+e),r=""};for(let t=0;t<e.length;t++){let h=e[t];o?(r+=h,o=!1):i.includes(h)?a=a===h?null:a||h:n.includes(h)?o=!0:a?r+=h:s.includes(h)?l(h):r+=h}return l(),t}class Pe{#Q;#i;constructor(e){this.#Q=e,this.#i=c(this.constructor.name.toLowerCase()),this.#i.log("Initializing...")}get services(){return this.#Q}get log(){return this.#i}async autocompleteArgs(e){return[]}async execute(e){throw Error(`Command '${this.constructor.name}' must implement the 'execute' method.`)}}async function $e(e){let t=await fetch(e);if(!t.ok)throw Error(`HTTP error! status: ${t.status} for url: ${e}`);return t.text()}var Oe;Oe=e("cdQpk");class qe extends Pe{static DATA_FILE=new URL(Oe);static DESCRIPTION="A short introduction.";constructor(e){super(e)}async execute(e){this.log.log("Executing...");let t=document.createElement("div");t.style.whiteSpace="pre-wrap";try{let e=await $e(qe.DATA_FILE);this.log.log(`Welcome message loaded successfully. ${e.length} characters.`),t.innerText=e}catch(e){this.log.error("Error loading welcome message:",e),t.innerText="Error: Could not load welcome message."}return t}static man(){return"NAME\n       welcome - A friendly introduction to the terminal.\n\nDESCRIPTION\n       The welcome command displays a greeting message and basic instructions for using the terminal.\n       It is typically the first command executed when the terminal starts.\n\nUSAGE\n       welcome\n\n       This command takes no arguments.\n\nEXAMPLES\n       $ welcome\n       (Displays the welcome message.)"}}let Ne=[{Type:"Image",Source:"/fs/photos/2024/2024.04.08.jpg",Id:"profile-picture"},{Type:"Text",Title:"Name",Value:"Afshin Arefi"},{Type:"Text",Title:"Description",Value:"I am a software engineer mostly interested in low level programming, data pipelines, and data manipulation. Currently I am working at Huawei as a Senior Compiler Engineer working with llvm, the kernel, and the loader."},{Type:"Text",Title:"Email",Value:"arefi.afshin@gmail.com"},{Type:"Text",Title:"LinkedIn",Value:"https://www.linkedin.com/in/arefiafshin/"}];class Re extends Pe{static DESCRIPTION="A short introduction.";#Z;constructor(e){super(e),this.#Z=e.requestMedia}static man(){return"NAME\n       about - Display information about the author.\n\nSYNOPSIS\n       about\n\nDESCRIPTION\n       The about command displays a short bio, contact information, and a profile picture."}async autocompleteArgs(e){return[]}async execute(e){this.log.log("Executing...");let t=document.createElement("div");try{for(let e of Ne){let s,i=document.createElement("div");if("Text"===e.Type){s=document.createElement("p");let t=document.createElement("span");if(t.textContent=e.Title,t.classList.add("about-title"),s.appendChild(t),s.appendChild(document.createTextNode(": ")),e.Value.startsWith("http")){let t=document.createElement("a");t.href=e.Value,t.textContent=e.Value,t.target="_blank",s.appendChild(t)}else s.appendChild(document.createTextNode(e.Value))}else"Image"===e.Type&&((s=await this.#Z(e.Source)).id=e.Id);s&&(i.appendChild(s),t.appendChild(i))}}catch(e){this.log.error("Failed to fetch about information:",e),t.textContent=`Error: ${e.message}`}return t}}class De extends Pe{static DESCRIPTION="List current environment variables.";#K;constructor(e){super(e),this.#K=this.services.getAllCategorizedVariables}async execute(e){this.log.log("Executing...");let t=document.createElement("pre"),s=await this.#K(),i="",n=(e,t)=>{if(0===Object.keys(t).length)return"";let s=`\n# ${e} Variables\n`;for(let[e,i]of Object.entries(t))"string"==typeof i&&(/\s/.test(i)||i.startsWith("{")&&i.endsWith("}"))?s+=`${e}="${i}"\n`:s+=`${e}=${i}\n`;return s};return i+=n("Session (In-Memory)",s.TEMP||{}),i+=n("Local (Browser Storage)",s.LOCAL),i+=n("Remote (User Account)",s.SYSTEM),t.innerText=(i+=n("User (Configurable)",s.USERSPACE)).trim(),t}static man(){return"NAME\n       env - Display environment variables.\n\nSYNOPSIS\n       env [OPTION]...\n\nDESCRIPTION\n       The env command prints the current environment variables to standard output.\n       Each variable is displayed on a new line in the format KEY=VALUE.\n\nOPTIONS\n       Currently, this command does not support any options.\n\nEXAMPLES\n       $ env\n       (Displays all current environment variables.)"}}class Le extends Pe{static DESCRIPTION="Lists available commands.";#ee;#te;constructor(e){super(e),this.#ee=this.services.getCommandList,this.#te=this.services.getCommandMeta}static man(){return"NAME\n       help - Display information about available commands.\n\nSYNOPSIS\n       help\n\nDESCRIPTION\n       The help command lists all commands available in the terminal, along with a brief description for each.\n       It is useful for discovering what commands can be used.\n\nUSAGE\n       help\n\n       This command takes no arguments.\n\nEXAMPLES\n       $ help\n       (Displays a list of all commands and their descriptions.)"}async execute(e){this.log.log("Executing...");let t=document.createElement("div"),s=await this.#ee();if(0===s.length)return t.textContent="No commands available.",t;let i=Math.max(...s.map(e=>e.length))+4;t.style.whiteSpace="pre-wrap";let n="";for(let e of s){let t=await this.#te(e,"DESCRIPTION")||"No description available.";n+=`${e.padEnd(i)} : ${t}\n`}return t.textContent=n.trim(),t}}class Ve extends Pe{static DESCRIPTION="Shows the manual page for a command.";#ee;#te;constructor(e){super(e),this.#ee=this.services.getCommandList,this.#te=this.services.getCommandMeta}static man(){return"NAME\n       man - Display the manual page for a command.\n\nSYNOPSIS\n       man <command>\n\nDESCRIPTION\n       The man command displays the manual page for the specified command.\n       If no command is specified, it will prompt for a command name.\n\nUSAGE\n       man <command>\n\nEXAMPLES\n       $ man help\n       (Displays the manual page for the 'help' command.)"}async autocompleteArgs(e){if(e.length>1)return[];let t=await this.#ee(),s=e[0]||"";return t.includes(s)?[]:s?t.filter(e=>e.startsWith(s)):[]}async execute(e){this.log.log("Executing with args:",e);let t=document.createElement("div");if(e.length<=1)return t.textContent="Usage: man <command>\nPlease specify a command name.",t;let s=e[1];if(!s){let e=document.createElement("p");return e.textContent="Usage: man <command>\nPlease specify a command name.",t.appendChild(e),t}let i=s.toLowerCase(),n=await this.#ee();this.log.log("Searching for command:",i);let r=n.find(e=>e.toLowerCase()===i),a=r?await this.#te(r,"man"):void 0;if(this.log.log("Exact match found:",r),!a){let e=n.filter(e=>e.toLowerCase().startsWith(i));if(this.log.log("Partial matches found:",e),1!==e.length)return e.length>1?(t.textContent=`man: ambiguous command '${s}'; possibilities: ${e.join(" ")}`,this.log.warn("Ambiguous command:",{input:s,matches:e}),t):(t.textContent=`No manual entry for '${s}'.`,t);a=await this.#te(e[0],"man"),this.log.log("Unique partial match found:",e[0])}return a?(this.log.log("Displaying man page."),t.style.whiteSpace="pre-wrap",t.textContent=a):(this.log.warn(`No man page function found for command: "${s}"`),t.textContent=`No manual entry for '${s}'.`),t}}class Ue extends Pe{static DESCRIPTION="Shows the command history.";#se;constructor(e){super(e),this.#se=this.services.getHistory}static man(){return"NAME\n       history - Display the command history.\n\nSYNOPSIS\n       history\n\nDESCRIPTION\n       The history command displays a list of previously entered commands.\n\nUSAGE\n       history\n\nEXAMPLES\n       $ history\n       (Displays the list of commands entered in this session.)"}async execute(e){this.log.log("Executing...");let t=document.createElement("div"),s=await this.#se();if(!s||0===s.length)return t.textContent="No history available.",t;let i=String(s.length).length;return t.style.whiteSpace="pre-wrap",t.textContent=s.map((e,t)=>` ${String(s.length-t).padStart(i)}:  ${e}`).join("\n"),t}}class Fe extends Pe{#ie;#ne;constructor(e){super(e),this.#ie=this.services.getDirectoryContents,this.#ne=this.services.autocompletePath}static man(){return"NAME\n       ls - List directory contents.\n\nSYNOPSIS\n       ls [directory]\n\nDESCRIPTION\n       The ls command lists files and directories in the specified location.\n       If no location is given, it lists the current directory."}async autocompleteArgs(e){let t=e.filter(e=>!e.trim().startsWith("-")).join("");try{let e=await this.#ie(t||"."),s=(e.directories||[]).map(e=>e.name+"/"),i=(e.files||[]).map(e=>e.name);return[...s,...i].sort()}catch(e){return this.log.warn(`Autocomplete failed for path "${t}":`,e),[]}}async execute(e){this.log.log("Executing with args:",e);let t=document.createElement("div"),s=e[1]||".";try{let e=await this.#ie(s);if("string"==typeof e){let s=document.createElement("pre");return s.innerText=e,t.appendChild(s),t}let i=function(e){let t=Array.isArray(e?.files)?e.files:[],s=[...(Array.isArray(e?.directories)?e.directories:[]).map(e=>({text:`${e.name}/`,style:{color:"var(--nnoitra-color-directory)"}})),...t.map(e=>{let t=null!==e.size?`(${e.size}b)`:"";return`${e.name} ${t}`})];var i=s.length>0?s:["(empty directory)"];let n=document.createElement("ul");if(n.style.listStyle="none",n.style.padding="0",n.style.margin="0",i&&0!==i.length)i.forEach(e=>{let t=document.createElement("li");"string"==typeof e?t.textContent=e:"object"==typeof e&&e.text&&(t.textContent=e.text,Object.assign(t.style,e.style)),n.appendChild(t)});else{let e=document.createElement("li");e.textContent="(empty)",n.appendChild(e)}return n}(e);t.appendChild(i)}catch(e){this.log.warn(`Cannot access path: "${s}"`,e),t.textContent=`ls: cannot access '${s}': ${e.message}`}return t}}class ze extends Pe{static DESCRIPTION="Change the current working directory.";#re;#ie;constructor(e){super(e),this.#re=this.services.changeDirectory,this.#ie=this.services.getDirectoryContents}static man(){return"NAME\n       cd - Change the current directory.\n\nSYNOPSIS\n       cd [directory]\n\nDESCRIPTION\n       The cd command changes the current working directory to the specified location.\n       If no location is given, it changes to the root directory."}async autocompleteArgs(e){let t=e.join(""),s=t.lastIndexOf("/"),i=-1===s?".":t.substring(0,s+1)||"/";try{return((await this.#ie(i)).directories||[]).map(e=>e.name+"/").sort()}catch(e){return this.log.warn(`Autocomplete failed for path "${t}":`,e),[]}}async execute(e){this.log.log("Executing with args:",e);let t=document.createElement("div"),s=e.slice(1).join("").trim()||"/";try{await this.#re(s)}catch(e){t.textContent=`cd: ${s}: ${e.message}`}return t}}class je extends Pe{static DESCRIPTION="Print the content of a FILE";#ae;#ie;constructor(e){super(e),this.#ae=this.services.getFileContents,this.#ie=this.services.getDirectoryContents}static man(){return"NAME\n       cat - Concatenate and print files.\n\nSYNOPSIS\n       cat [FILE]...\n\nDESCRIPTION\n       The cat command reads files sequentially, writing them to the standard output."}async autocompleteArgs(e){let t=e.join("");try{let e=await this.#ie(t||"."),s=/\.txt$/i,i=(e.directories||[]).map(e=>e.name+"/"),n=(e.files||[]).filter(e=>s.test(e.name)).map(e=>e.name);return[...i,...n].sort()}catch(e){return this.log.warn(`Autocomplete failed for path "${t}":`,e),[]}}async execute(e){this.log.log("Executing with args:",e);let t=document.createElement("pre"),s=e.slice(1).join("").trim();if(!s)return this.log.warn("Missing file operand."),t.textContent="cat: missing file operand",t;try{t.textContent=await this.#ae(s)}catch(e){this.log.error(`Failed to get file content for "${s}":`,e),t.textContent=`cat: ${s}: ${e.message}`}return t}}class He extends Pe{static DESCRIPTION="Clear the terminal output.";#oe;constructor(e){super(e),this.#oe=this.services.clearScreen}execute(e){return this.log.log("Executing clear command."),this.#oe(),document.createElement("div")}static man(){return"NAME\n       clear - Clear the terminal output.\n\nSYNOPSIS\n       clear\n\nDESCRIPTION\n       The clear command erases all output in the terminal window."}}class _e extends Pe{static DESCRIPTION="View a photo or video.";#ie;#le;#Z;constructor(e){super(e),this.#ie=this.services.getDirectoryContents,this.#le=this.services.getPublicUrl,this.#Z=this.services.requestMedia}static man(){return"NAME\n       view - Display an image or video file.\n\nSYNOPSIS\n       view [file]\n\nDESCRIPTION\n       The view command displays the specified image (png, jpg, gif) or video (mp4, webm) file.\n       The path can be absolute or relative to the current directory."}async autocompleteArgs(e){let t=e.join("");try{let e=await this.#ie(t||"."),s=/\.(png|jpg|jpeg|gif|webp|mp4|webm)$/i,i=(e.directories||[]).map(e=>e.name+"/"),n=(e.files||[]).filter(e=>s.test(e.name)).map(e=>e.name);return[...i,...n].sort()}catch(e){return this.log.warn(`Autocomplete failed for path "${t}":`,e),[]}}async execute(e){this.log.log("Executing with args:",e);let t=document.createElement("div"),s=e.slice(1).join("").trim();if(!s)return this.log.warn("Missing file operand."),t.textContent="view: missing file operand",t;if(!/\.(png|jpg|jpeg|gif|webp|mp4|webm)$/i.test(s))return this.log.warn(`File is not a supported media type: "${s}"`),t.textContent=`view: ${s}: Unsupported file type.`,t;let i=await this.#le(s),n=await this.#Z(i);return t.appendChild(n),t}}class Ye extends Pe{static DESCRIPTION="Add a new user.";#he;#z;constructor(e){super(e),this.#he=this.services.prompt,this.#z=this.services.addUser}static man(){return"\nNAME\n       adduser - Add a new user.\n\nSYNOPSIS\n       adduser [username]\n\nDESCRIPTION\n       The adduser command creates a new user account. You will be prompted to enter and confirm a password.\n       Usernames must be between 3 and 32 characters and can only contain letters, numbers, and underscores.\n"}async autocompleteArgs(e){return{suggestions:[],description:"<USERNAME>"}}async execute(e){this.log.log("Executing with args:",e);let t=document.createElement("div"),s=e[1];if(!s)return t.textContent="adduser: missing username operand.",t;if(!/^[a-zA-Z0-9_]{3,32}$/.test(s))return t.textContent=`adduser: invalid username '${s}'. Usernames must be 3-32 characters and contain only letters, numbers, and underscores.`,t;try{let e=await this.#he("Password: ",{isSecret:!0,allowHistory:!1,allowAutocomplete:!1});if(null===e)return t.textContent="adduser: Operation cancelled.",t;let i=await this.#he("Confirm password: ",{isSecret:!0,allowHistory:!1,allowAutocomplete:!1});if(null===i)return t.textContent="adduser: Operation cancelled.",t;if(e!==i)return t.textContent="adduser: Passwords do not match. User not created.",t;t.textContent="Creating user...";let n=await this.#z(s,e);"success"===n.status?t.textContent=`User '${s}' created successfully.`:t.textContent=`adduser: ${n.message}`}catch(e){this.log.error("Error during user creation:",e),t.textContent="adduser: An unexpected error occurred."}return t}}class Be extends Pe{static DESCRIPTION="Log in as a user.";#he;#ce;constructor(e){super(e),this.#he=this.services.prompt,this.#ce=this.services.login}static man(){return"NAME\n       login - Log in to the system.\n\nSYNOPSIS\n       login [username]\n\nDESCRIPTION\n       Authenticates the user and starts a session."}async autocompleteArgs(e){return e.length>1?[]:{suggestions:[],description:"<USERNAME>"}}static isAvailable(e){return!e.isLoggedIn}async execute(e){this.log.log("Executing with args:",e);let t=document.createElement("div"),s=e[1];if(!s)return t.textContent="Usage: login <username>",t;this.log.log("Prompting user for password.");let i=await this.#he("Password: ",{isSecret:!0,allowHistory:!1,allowAutocomplete:!1});try{t.textContent=(await this.#ce(s,i)).message}catch(e){this.log.error("Network or parsing error during login:",e),t.textContent=`Error: ${e.message}`}return t}}class We extends Pe{static DESCRIPTION="Log out of the current session.";#de;constructor(e){super(e),this.#de=this.services.logout}static man(){return"NAME\n       logout - Log out of the system.\n\nSYNOPSIS\n       logout\n\nDESCRIPTION\n       Ends the current user session."}static isAvailable(e){return e.isLoggedIn}async execute(e){this.log.log("Executing...");let t=document.createElement("div");try{t.textContent=(await this.#de()).message}catch(e){this.log.error("Network or parsing error during logout:",e),t.textContent=`Error: ${e.message}`}return t}}class Je extends Pe{static DESCRIPTION="Change user password.";#he;#j;constructor(e){super(e),this.#he=this.services.prompt,this.#j=this.services.changePassword}static man(){return"\nNAME\n       passwd - change user password\n\nSYNOPSIS\n       passwd\n\nDESCRIPTION\n       The passwd command changes the password for the current user.\n       You will be prompted for your old password, and then for the new password twice.\n"}static isAvailable(e){return e.isLoggedIn}async execute(e){this.log.log("Executing...");let t=document.createElement("div"),s={isSecret:!0,allowHistory:!1,allowAutocomplete:!1};try{let e=await this.#he("Old password: ",s),i=await this.#he("New password: ",s);if(i!==await this.#he("Confirm new password: ",s))return t.textContent="passwd: Passwords do not match. Password not changed.",t;if(!i)return t.textContent="passwd: Password cannot be empty.",t;t.textContent=(await this.#j(e,i)).message}catch(e){this.log.warn("Password change operation cancelled or failed:",e),t.textContent="passwd: Operation cancelled."}return t}}class Xe extends Pe{static DESCRIPTION="Define or display aliases.";#ue;#me;constructor(e){super(e),this.#ue=this.services.getAliases,this.#me=this.services.setAliases}static man(){return"NAME\n       alias - Define or display command aliases.\n\nSYNOPSIS\n       alias [name[=value] ...]\n\nDESCRIPTION\n       The alias command allows you to create shortcuts for longer commands.\n\n       - With no arguments, 'alias' prints the list of all current aliases.\n       - With 'name=value', it defines an alias. The value can be a string in quotes.\n\nEXAMPLES\n       $ alias\n       (Displays all aliases.)\n\n       $ alias l=\"ls -l\"\n       (Creates an alias 'l' for 'ls -l'.)"}async execute(e){this.log.log("Executing with args:",e);let t=document.createElement("div");t.style.whiteSpace="pre-wrap";let s=await this.#ue();if(e.length<=1){if(0===Object.keys(s).length)this.log.log("No aliases found to display."),t.textContent="No aliases defined.";else{let e="";for(let[t,i]of Object.entries(s))e+=`alias ${t}='${i}'\n`;t.textContent=e.trim(),this.log.log("Displaying all defined aliases.")}return t}let i=e.slice(1).join(""),n=i.indexOf("=");if(-1===n)return t.textContent="alias: usage: alias [name[=value] ...]",t;let r=i.substring(0,n).trim(),a=i.substring(n+1).trim();return(a.startsWith('"')&&a.endsWith('"')||a.startsWith("'")&&a.endsWith("'"))&&(a=a.slice(1,-1)),r?(s[r]=a,this.#me(s),this.log.log(`Created alias: ${r}='${a}'`)):(this.log.warn("Invalid alias format:",i),t.textContent="alias: invalid alias name"),t}}class Ge extends Pe{static DESCRIPTION="Remove an alias.";#ue;#me;constructor(e){super(e),this.#ue=this.services.getAliases,this.#me=this.services.setAliases}static man(){return"NAME\n       unalias - Remove an alias.\n\nSYNOPSIS\n       unalias <alias_name>\n\nDESCRIPTION\n       The unalias command removes the specified alias from the list of defined aliases.\n\nEXAMPLES\n       $ unalias l\n       (Removes the alias 'l'.)"}async autocompleteArgs(e){if(e.length>1)return[];let t=Object.keys(await this.#ue()),s=e[0]||"";return t.filter(e=>e.startsWith(s))}async execute(e){this.log.log("Executing with args:",e);let t=document.createElement("pre"),s=e[1];if(!s)return this.log.warn("No alias name provided."),t.textContent="unalias: usage: unalias <alias_name>",t;let i=await this.#ue();return s in i?(this.log.log(`Removing alias: "${s}"`),delete i[s],this.#me(i),t.textContent=`Alias '${s}' removed.`):(this.log.warn(`Alias not found: "${s}"`),t.textContent=`unalias: ${s}: not found`),t}}class Qe extends Pe{static DESCRIPTION="Set or display user environment variables.";#pe;#K;constructor(e){super(e),this.#pe=this.services.setUserspaceVariable,this.#K=this.services.getAllCategorizedVariables}static man(){return"NAME\n       export - Set or display user environment variables.\n\nSYNOPSIS\n       export [name[=value] ...]\n\nDESCRIPTION\n       The export command allows you to view and modify user-configurable environment variables.\n       These variables are saved to your user profile.\n\n       - With no arguments, 'export' prints the list of all current user variables.\n       - With 'name=value', it defines a variable. The value can be a string in quotes.\n\nEXAMPLES\n       $ export\n       (Displays all user-configurable variables.)\n\n       $ export PS1=\"{user}$ \"\n       (Changes the command prompt format.)"}async autocompleteArgs(e){if(e.length>1)return[];let t=e[0]||"",s=(await this.#K()).USERSPACE,i=Object.keys(s),n=t.split("="),r=n[0].toUpperCase();if(1===n.length){let e=i.filter(e=>e.startsWith(r));return 1===e.length?[`${e[0]}=`]:e}if(n.length>1&&s.hasOwnProperty(r)){let e=s[r];return[`${r}="${e}"`]}return[]}async execute(e){let t;this.log.log("Executing with args:",e);let s=document.createElement("pre"),i=e.slice(1).join(" "),n=await this.#K(),r=n.USERSPACE||{};if(!i){let e="";for(let[t,s]of Object.entries(r))e+=`export ${t}="${s}"\n`;return s.textContent=e.trim()||"No user variables defined.",s}let a=(t=i.match(/^([^=]+)=(.*)$/))?{name:t[1].trim(),value:t[2].trim().replace(/^['"]|['"]$/g,"")}:null;if(a){let e=a.name.toUpperCase();n.SYSTEM&&n.SYSTEM.hasOwnProperty(e)||n.LOCAL&&n.LOCAL.hasOwnProperty(e)||n.TEMP&&n.TEMP.hasOwnProperty(e)?s.textContent=`export: permission denied: \`${a.name}\` is a read-only variable.`:(this.#pe(e,a.value),this.log.log(`Set variable: ${a.name}='${a.value}'`))}else s.textContent='export: invalid format. Use name="value"',this.log.warn("Invalid export format:",i);return s}}class Ze extends Pe{static DESCRIPTION="Remove a user environment variable.";#ge;#K;constructor(e){super(e),this.#ge=this.services.deleteUserspaceVariable,this.#K=this.services.getAllCategorizedVariables}static man(){return"NAME\n       unset - Remove a user environment variable.\n\nSYNOPSIS\n       unset <variable_name>\n\nDESCRIPTION\n       The unset command removes the specified variable from the list of user-defined environment variables.\n       It can only remove variables set with the 'export' command.\n\nEXAMPLES\n       $ unset MY_VAR\n       (Removes the user variable 'MY_VAR'.)"}async autocompleteArgs(e){if(e.length>1)return[];let t=Object.keys((await this.#K()).USERSPACE||{}),s=(e[0]||"").toUpperCase();return t.filter(e=>e.startsWith(s))}async execute(e){this.log.log("Executing with args:",e);let t=document.createElement("pre"),s=e[1];if(!s)return t.textContent="unset: usage: unset <variable_name>",t;let i=s.toUpperCase();return Object.keys((await this.#K()).USERSPACE||{}).includes(i)?await this.#ge(i):t.textContent=`unset: ${s}: not found in userspace`,t}}class Ke extends Pe{static DESCRIPTION="Set the terminal color theme.";#ye;#fe;#ve;constructor(e){super(e),this.#ye=this.services.setTheme,this.#ve=this.services.getSystemVariable,this.#fe=this.services.getValidThemes}static man(){return"NAME\n       theme - Set the terminal color theme.\n\nSYNOPSIS\n       theme [color]\n\nDESCRIPTION\n       Changes the terminal's color scheme. The selected theme is saved to your user profile.\n\n       Available colors: green, yellow, orange, red\n\nEXAMPLES\n       $ theme\n       (Displays the current theme.)\n\n       $ theme yellow\n       (Sets the theme to yellow.)"}async autocompleteArgs(e){if(e.length>1)return[];let t=e[0]||"";return(await this.#fe()).filter(e=>e.startsWith(t))}async execute(e){let t=document.createElement("div"),s=e[1],i=await this.#fe();if(!s){let{value:e}=await this.#ve("THEME");return t.textContent=`Current theme: ${e}\nAvailable themes: ${i.join(", ")}`,t}return i.includes(s)?(this.#ye(s),t.textContent=`Theme set to '${s}'.`,this.log.log(`Theme set to: ${s}`)):(t.textContent=`Error: Invalid theme '${s}'.\nAvailable themes: ${i.join(", ")}`,this.log.warn(`Invalid theme name provided: ${s}`)),t}}var et;et=e("6eguK");class tt extends Pe{static DATA_FILE=new URL(et);static DESCRIPTION="Show version information.";constructor(e){super(e)}async execute(e){this.log.log("Executing...");let t=document.createElement("div");t.style.whiteSpace="pre-wrap";try{let e=await fetch(tt.DATA_FILE);if(!e.ok)throw Error(`Failed to load version information: ${e.statusText}`);t.innerText=await e.text()}catch(e){this.log.error("Error loading version information:",e),t.innerText="Error: Could not load version information."}return t}static man(){return"NAME\n       version - Show version information.\n\nDESCRIPTION\n       The version command displays the application's version and build information."}}class st extends ce{#we=new Map;#be;constructor(e){super(e),this.#be=new Ie(e),this.#Se(),this.log.log("Initializing...")}#Se(){this.register("welcome",qe,[]),this.register("about",Re,["requestMedia"]),this.register("env",De,["getAllCategorizedVariables"]),this.register("help",Le,["getCommandList","getCommandMeta"]),this.register("man",Ve,["getCommandList","getCommandMeta"]),this.register("history",Ue,["getHistory"]),this.register("ls",Fe,["getDirectoryContents"]),this.register("cd",ze,["changeDirectory","getDirectoryContents"]),this.register("cat",je,["getFileContents","getDirectoryContents"]),this.register("clear",He,["clearScreen"]),this.register("view",_e,["getDirectoryContents","getPublicUrl","requestMedia"]),this.register("adduser",Ye,["prompt","addUser"]),this.register("login",Be,["prompt","login"]),this.register("logout",We,["logout"]),this.register("passwd",Je,["prompt","changePassword"]),this.register("alias",Xe,["getAliases","setAliases"]),this.register("unalias",Ge,["getAliases","setAliases"]),this.register("export",Qe,["setUserspaceVariable","getAllCategorizedVariables"]),this.register("unset",Ze,["deleteUserspaceVariable","getAllCategorizedVariables"]),this.register("theme",Ke,["getValidThemes","setTheme","getSystemVariable"]),this.register("version",tt,[])}get eventHandlers(){return{[H]:this.#xe.bind(this),[J]:this.#Ce.bind(this),[X]:this.#Ee.bind(this),[W]:this.#Ae.bind(this),[k]:this.#L.bind(this),[G]:this.#Te.bind(this),[Q]:this.#ke.bind(this)}}register(e,t,s=[]){this.#we.set(e,{CommandClass:t,requiredServices:s})}#xe({commandString:e,outputElement:t}){this.execute(e,t)}getCommand(e){let t=this.#we.get(e);if(t){let{CommandClass:s,requiredServices:i=[]}=t;return new s(i.reduce((t,s)=>("function"==typeof this.#be[s]?t[s]=this.#be[s].bind(this.#be):this.log.warn(`Command '${e}' requested unknown function '${s}'.`),t),{}))}return null}getCommandClass(e){let t=this.#we.get(e);return t?t.CommandClass:void 0}getCommandNames(){return Array.from(this.#we.keys())}async#Ie(){return[...new Set([...await this.getPermittedCommandNames()])].sort()}async getPermittedCommandNames(){let e=this.getCommandNames(),t=await this.#Me();return e.filter(e=>{let s=this.getCommandClass(e);return!s||"function"!=typeof s.isAvailable||s.isAvailable(t)}).sort()}async#Me(){return{isLoggedIn:await this.#be.isLoggedIn()}}async#Pe(e){let t=[...e],s=(t[0]||"").trim();if(!s)return{commandName:"",args:[]};let i=await this.#be.getAliases();return i[s]&&(s=((t=[...Me(i[s]),...t.slice(1)])[0]||"").trim()),{commandName:s,args:t}}async execute(e,t){try{let s=e.trim();if(!s)return;let i=Me(s);if(0===i.length)return;let{commandName:n,args:r}=await this.#Pe(i);if(!n)return;let a=t?t.element:null;if(this.#we.has(n))try{let e=this.getCommand(n);this.log.log(`Executing command: "${r}"`);let t=await e.execute(r);a&&a.appendChild(t)}catch(e){a&&(a.textContent=`Error executing ${n}: ${e.message}`),this.log.error(`Error executing ${n}:`,e)}else a&&(a.textContent=`${n}: command not found`)}finally{this.dispatch(_)}}async#Ce({respond:e}){try{let{value:t}=await this.request(g,{key:we});e({aliases:JSON.parse(t||"{}")})}catch(t){this.log.error("Failed to get aliases:",t),e({aliases:{}})}}#Ee({aliases:e}){this.dispatch(w,{key:we,value:JSON.stringify(e)})}async#Te({respond:e}){e({commands:await this.getPermittedCommandNames()})}#ke({commandName:e,metaKey:t,respond:s}){let i=this.getCommandClass(e);if(i&&void 0!==i[t]){let e=i[t];s("function"==typeof e?{value:e()}:{value:e})}else s({value:void 0})}async#Ae({parts:e,respond:t}){let s=[],i="";if(e.length<=1)s=(await this.#Ie()).map(e=>e+" ");else{let{commandName:t,args:n}=await this.#Pe(e),r=this.getCommandClass(t);if(r&&"function"==typeof r.prototype.autocompleteArgs){let e=this.getCommand(t),r=await e.autocompleteArgs(n.slice(1));Array.isArray(r)?s=r:"object"==typeof r&&null!==r&&(s=r.suggestions||[],i=r.description||"")}}t({suggestions:s,description:i})}#L({key:e,respond:t}){e===we&&t({value:"{}"})}}class it extends ce{#M;constructor(e,t={}){super(e),this.#M=new ge(t.apiUrl),this.log.log("Initializing...")}get eventHandlers(){return{[oe]:this.#$e.bind(this),[ae]:this.#Oe.bind(this),[re]:this.#qe.bind(this),[he]:this.#Ne.bind(this),[le]:this.#Re.bind(this),[k]:this.#L.bind(this)}}async#Oe({path:e,respond:t}){try{t({contents:await this.#ie(e)})}catch(e){t({error:e})}}async#$e({path:e,respond:t}){try{t({contents:await this.#ae(e)})}catch(e){t({error:e})}}async#qe({path:e,respond:t}){try{let s=await this.#De(e,!0);this.dispatch(b,{key:"PWD",value:s}),t({success:!0})}catch(e){t({error:e})}}async#Ne({path:e,respond:t}){try{t({path:await this.#De(e,!1)})}catch(e){t({error:e})}}async#Re({path:e,respond:t}){try{let{value:s}=await this.request(y,{key:"PWD"});t({url:(await this.#Le("get_public_url",{path:e,pwd:s})).url})}catch(e){t({error:e})}}#L({key:e,respond:t}){"PWD"===e&&(this.dispatch(b,{key:e,value:"/"}),t({value:"/"}))}async#ie(e){let{value:t}=await this.request(y,{key:"PWD"});return this.#Le("ls",{path:e,pwd:t})}async#ae(e){let{value:t}=await this.request(y,{key:"PWD"});return(await this.#Le("cat",{path:e,pwd:t})).content}async#Le(e,t={}){try{let s=await this.#M.get({action:e,...t});if(s.error)throw Error(s.error);return s}catch(s){throw this.log.error(`Error during API request for action "${e}" with path "${t.path}":`,s),s}}async#De(e,t){let{value:s}=await this.request(y,{key:"PWD"});return(await this.#Le("resolve",{path:e,pwd:s,must_be_dir:t})).path}}let nt="THEME",rt="green";class at extends ce{static VALID_THEMES=["green","yellow","orange","red"];#Ve=null;constructor(e){super(e),this.log.log("Initializing...")}setView(e){this.#Ve=e,this.log.log("View connected.")}async start(){let{value:e}=await this.request(g,{key:nt}),t=e||rt;this.applyTheme(t)}get eventHandlers(){return{[se]:this.#Ue.bind(this),[k]:this.#L.bind(this),[ie]:this.#Fe.bind(this),[I]:this.#o.bind(this)}}#Ue({themeName:e,respond:t}){t({theme:this.applyTheme(e)})}async#o(){this.log.log("User changed, re-evaluating theme.");let{value:e}=await this.request(g,{key:nt}),t=e||rt;this.applyTheme(t,!1)}#L({key:e,respond:t}){e===nt&&(this.dispatch(w,{key:e,value:rt}),t({value:rt}))}#Fe({respond:e}){e({themes:this.getValidThemes()})}applyTheme(e){let t=at.VALID_THEMES.includes(e)?e:rt;if(this.#Ve){let e=`var(--nnoitra-color-${t})`;this.#Ve.style.setProperty("--nnoitra-color-theme",e)}return this.dispatch(ee,{themeName:t}),this.dispatch(w,{key:nt,value:t}),this.log.log(`Applied theme: ${t}`),t}getValidThemes(){return at.VALID_THEMES}}class ot extends ce{#Ve=null;#ze="";#je=!1;#He=!1;#_e=!1;#Ye=!1;constructor(e){super(e),this.log.log("Initializing...")}setView(e){this.#Ve=e,this.#Ve.addEventListener("enter",e=>this.#Be(e.detail.value)),this.#Ve.addEventListener("tab",()=>this.#We()),this.#Ve.addEventListener("arrow-up",()=>this.#Je()),this.#Ve.addEventListener("arrow-down",()=>this.#Xe()),this.#Ve.addEventListener("swipe-right",()=>this.#We()),this.#Ve.setAttribute("disabled","")}get eventHandlers(){return{[Z]:this.#Ge.bind(this),[U]:this.#Qe.bind(this),[B]:this.#Ze.bind(this)}}#Be(e){this.respond&&(this.#Ke(e),this.#Ye=!1,this.#Ve.clear())}#We(){this.log.log("Tab key pressed - triggering autocomplete if allowed.",this.#_e),this.#_e&&this.#et(this.#Ve.getValue())}#Je(){this.#He&&(this.#Ye||(this.#ze=this.#Ve.getValue(),this.#Ye=!0),this.#Ve.setAttribute("disabled",""),this.dispatch(L))}#Xe(){this.log.log("ArrowDown key pressed - requesting next history if allowed."),this.#He&&this.#Ye&&(this.#Ve.setAttribute("disabled",""),this.dispatch(V))}#et(e){if(this.#_e){this.#Ve.setAttribute("disabled","");let t=this.#Ve.getCursorPosition(),s=e.substring(0,t),i=e.substring(t);this.log.log("Dispatching autocomplete request:",{beforeCursorText:s,afterCursorText:i}),this.dispatch(Y,{beforeCursorText:s,afterCursorText:i})}}#tt(e,t={}){this.#je=t.isSecret||!1,this.#He=t.allowHistory||!1,this.#_e=t.allowAutocomplete||!1,this.#ze="",this.#Ye=!1,this.#Ve.clear(),this.#Ve.removeAttribute("disabled"),this.#Ve.setAttribute("placeholder",e),this.#je?this.#Ve.setAttribute("secret",""):this.#Ve.removeAttribute("secret"),this.#Ve.focus()}#Ke(e){this.respond({value:e}),this.#Ve.setAttribute("disabled","")}#Ge(e){let{prompt:t,options:s,respond:i}=e;this.#tt(t,s),this.respond=i}#Qe(e){this.#Ve&&(this.#Ve.removeAttribute("disabled"),void 0!==e.command&&(e.index>0?(this.#Ve.setValue(e.command),this.#Ve.setAttribute("icon-text",`H:${e.index}`)):(this.#Ve.setValue(this.#ze),this.#Ye=!1,this.#ze="",this.#Ve.removeAttribute("icon-text"))))}#Ze(e){if(this.#Ve)try{let{newTextBeforeCursor:t,afterCursorText:s}=e;if(void 0!==t){let e=t+s;this.#Ve.setValue(e),this.#Ve.setCursorPosition(t.length)}}finally{this.#Ve.removeAttribute("disabled")}}}class lt extends ce{#Ve=null;#st;constructor(e){super(e),this.log.log("Initializing...")}setView(e){this.#Ve=e,this.#st=new ResizeObserver(()=>{this.dispatch(te)}),this.#st.observe(this.#Ve)}get eventHandlers(){return{[B]:this.#it.bind(this),[H]:this.#nt.bind(this)}}#it(e){if(!this.#Ve)return;let{options:t=[],description:s,prefixLength:i}=e;if(this.#Ve.innerHTML="",s){let e=document.createElement("li");e.textContent=s,this.#Ve.appendChild(e),this.#Ve.setAttribute("prefix-length","0"),this.#Ve.removeAttribute("hidden")}else if(t.length>1){let e=document.createDocumentFragment();t.forEach((t,s)=>{let i=document.createElement("li");i.textContent=t,e.appendChild(i)}),this.#Ve.appendChild(e),this.#Ve.setAttribute("prefix-length",i),this.#Ve.removeAttribute("hidden")}else this.#Ve.setAttribute("hidden","")}#nt(){this.#Ve&&(this.#Ve.setAttribute("hidden",""),this.#Ve.innerHTML="")}}function ht(e){let{size:t,bgColor:s,symbolColor:i}=e,n=document.createElement("canvas");n.width=n.height=t;let r=n.getContext("2d"),a=Math.max(2,.15*t);r.roundRect(0,0,t,t,a),r.fillStyle=s,r.fill();let o=.3*t;r.beginPath(),r.arc(t/2,t/2,o,0,2*Math.PI),r.fillStyle=i,r.fill();let l=.22*t;return r.beginPath(),r.arc(.47*t,.39*t,l,0,2*Math.PI),"transparent"==s?(r.globalCompositeOperation="destination-out",r.fill(),r.globalCompositeOperation="source-over"):(r.fillStyle=s,r.fill()),n.toDataURL("image/png")}function ct(e){let{size:t,bgColor:s,symbolColor:i}=e,n=document.createElement("canvas");n.width=n.height=t;let r=n.getContext("2d"),a=Math.max(2,.15*t);r.roundRect(0,0,t,t,a),r.fillStyle=s,r.fill();let o=.2*t,l=t-o,h=t-o;return r.beginPath(),r.moveTo(o,o),r.lineTo(h,o),r.lineTo(o,l),r.lineTo(h,l),r.closePath(),r.fillStyle=i,r.fill(),n.toDataURL("image/png")}function dt(e){let{size:t,bgColor:s,symbolColor:i}=e,n=document.createElement("canvas");n.width=n.height=t;let r=n.getContext("2d"),a=Math.max(2,.15*t);r.roundRect(0,0,t,t,a),r.fillStyle=s,r.fill(),r.fillStyle=i,r.strokeStyle=i,r.lineWidth=Math.max(1,.15*t);let o=.15*t;return r.beginPath(),r.arc(.35*t,.35*t,o,0,2*Math.PI),r.stroke(),r.beginPath(),r.moveTo(.45*t,.45*t),r.lineTo(.7*t,.7*t),r.lineTo(.6*t,.8*t),r.stroke(),n.toDataURL("image/png")}class ut extends ce{static#rt=[16,32,64,128,180];#Ve=null;constructor(e){super(e),this.log.log("Initializing...")}setView(e){this.#Ve=e,this.log.log("View connected.")}get eventHandlers(){return{[ee]:this.#at.bind(this)}}#at(){if(!this.#Ve)return void this.log.warn("Cannot render favicon, view is not connected.");let e=getComputedStyle(this.#Ve),t={bgColor:e.getPropertyValue("--nnoitra-color-theme").trim()||"green",symbolColor:e.getPropertyValue("--nnoitra-color-text-highlight").trim()||"#000"};document.querySelectorAll("link[rel~='icon'], link[rel='apple-touch-icon']").forEach(e=>e.remove()),ut.#rt.forEach(e=>{let s=ht({...t,size:e});this.log.log(s);let i=document.createElement("link");i.rel=180===e?"apple-touch-icon":"icon",i.type="image/png",i.sizes=`${e}x${e}`,i.href=s,document.head.appendChild(i)})}}class mt extends HTMLElement{#ot;#lt={};#i;get log(){return this.#i}constructor(e){super(),this.#i=c(this.constructor.name);const t=new CSSStyleSheet;if(t.replaceSync("\n      /* Styles for encapsulation and structural fundamentals remain here.\n       * The 'var()' function will look up the Custom Property\n       * (which pierces the Shadow DOM) from the :root or host element.\n       */\n\n      /* Good practice to add this for consistent box model */\n      * {\n        box-sizing: border-box;\n      }\n\n      /* Apply colors and font-family to the host to establish inheritance\n       * These custom properties should be defined at a higher level (e.g., :root or body).\n       */\n      :host {\n        font-family: var(--nnoitra-font-family);\n        color: var(--nnoitra-color-theme);\n        font-size: var(--nnoitra-font-size);\n      }\n      "),this.#ot=this.attachShadow({mode:"closed"}),this.#ot.adoptedStyleSheets=[t],e){const t=this.#ht(e);this.#ot.appendChild(t)}this.#ct()}#ct(){this.#ot.querySelectorAll("[part]").forEach(e=>{let t=e.getAttribute("part");this.log.log(`Mapping ref: "${t}" to element`,e),this.#lt[t]=e})}get refs(){return this.#lt}get shadowRoot(){return this.#ot}#ht(e){let t=document.createElement("template");return t.innerHTML=e,t.content}}let pt=new CSSStyleSheet;pt.replaceSync("\n:host {\n  height: 100%;\n  aspect-ratio: 1;\n  margin: 0;\n  padding: 0;\n}\n\n[part=symbol] {\n  font-family: var(--nnoitra-font-family);\n  font-size: inherit;\n  color: var(--nnoitra-color-text-highlight); /* VAR */\n  background-color: var(--nnoitra-color-highlight); /* VAR */\n  display: inline-flex;\n  justify-content: center; /* Center horizontally */\n  align-items: center;     /* Center vertically */\n  border-radius: 3px;\n  margin: 0;\n  min-width: 1.5em;\n  height: 100%;\n  width: 100%;\n  padding: 0;\n  padding-left: 0.2em;\n  padding-right: 0.2em;\n}\n\n[part=symbol-container] {\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  margin-right: 3px;\n  padding: 0;\n  height: 100%;\n  width: 100%;  \n}\n");class gt extends mt{#dt={ready:">",busy:"⧗",key:"⚷"};static#ut=[16,32,48,64];constructor(){super('<span part="symbol-container"></span>'),this.shadowRoot.adoptedStyleSheets=[...this.shadowRoot.adoptedStyleSheets,pt],this.hasAttribute("type")||this.setAttribute("type","ready")}static get observedAttributes(){return["type","value"]}attributeChangedCallback(e,t,s){this.#mt()}#mt(){let e=this.getAttribute("type")||"ready",t=this.getAttribute("value"),s=this.refs["symbol-container"];switch(s.innerHTML="",e){case"busy":this.#pt(s,ct);break;case"key":this.#pt(s,dt);break;case"indexed":let e=document.createElement("span");e.part="symbol",e.textContent=`${t||""}:>`,s.appendChild(e);break;case"text":let i=document.createElement("span");i.part="symbol",i.textContent=t||"",s.appendChild(i);break;case"ready":this.#pt(s,ht)}}#pt(e,t){let s={bgColor:"transparent",symbolColor:getComputedStyle(this).getPropertyValue("--nnoitra-color-text-highlight").trim()},i=document.createElement("img");i.part="symbol",i.style.padding="0",i.style.borderRadius="3px",i.src=ht({...s,size:32}),i.srcset=gt.#ut.map(e=>`${t({...s,size:e})} ${e}w`).join(", "),e.appendChild(i)}}customElements.define("nnoitra-icon",gt);let yt=new CSSStyleSheet;yt.replaceSync("\n:host {\n  --line-height: 2em;\n  --line-margin: 3px;\n  display: block;\n  margin: 0;\n  margin-top: var(--line-margin);\n  padding: 0;\n}\n\n[part=header],\n[part=icon],\n[part=command-container],\n[part=output] {\n  display: none;\n}\n\n:host(.header-visible) [part=header] {\n  display: block;\n}\n\n:host(.active) [part=output] {\n  display: block;\n  margin-top: var(--line-margin);\n}\n\n:host(.active) [part=command-container] {\n  display: flex; /* Ensure it's a flex container when active */\n}\n\n:host(.active) [part=icon] {\n  display: block; /* Make the icon visible when its container is active */\n}\n\n[part=icon] {\n  margin: 0;\n  padding: 0;\n  /* Other styling for the icon is handled by the nnoitra-icon component itself */\n}\n\n[part=command-container] {\n  align-items: center;\n  height: var(--line-height);\n  padding: 0; /* Match header's padding */\n  border-radius: 3px;\n  margin: 0;\n  margin-top: var(--line-margin);\n}\n\n[part=command] {\n  word-break: break-all;\n  white-space: pre-wrap;\n  align-items: center;\n  flex-grow: 1; /* Take up remaining space */\n  color: var(--nnoitra-color-text); /* VAR */\n  margin: 0;\n  padding: 0;\n  margin-left: 5px; /* Space between icon and command */\n\n}\n[part=header] {\n  flex-grow: 1; /* Take up remaining space */\n  min-height: var(--line-height);\n  line-height: var(--line-height);\n  align-items: center;     /* Center vertically */\n  color: var(--nnoitra-color-text-highlight); /* VAR */\n  background-color: var(--nnoitra-color-highlight); /* VAR */\n  padding: 0px 5px;\n  border-radius: 3px;\n  margin: 0px;\n  margin-top: var(--line-margin);\n}\n\n[part=header]::before {\n  content: '\\200b'; /* Zero-width space */\n  display: inline-block; /* Ensures it contributes to the line box */\n}\n[part=output] {\n  color: var(--nnoitra-color-output);\n  margin: 0;\n}\n\n[part=output] pre {\n  white-space: pre-wrap; /* Preserve whitespace but wrap long lines */\n  word-wrap: break-word; /* Ensure long words without spaces also break */\n  margin: 0; /* Reset default margins on pre for consistency */\n}\n");class ft extends mt{constructor(){super("\n  <div part='header'></div>\n  <div part='command-container'>\n  <nnoitra-icon part='icon'></nnoitra-icon>\n  <span part='command'></span>\n  </div>\n  <div part='output'><slot></slot></div>\n  "),this.shadowRoot.adoptedStyleSheets=[...this.shadowRoot.adoptedStyleSheets,yt]}static get observedAttributes(){return["item-id","header-text","command"]}attributeChangedCallback(e,t,s){if(t!==s)switch(e){case"item-id":this.id=`term-item-${s}`,this.hasAttribute("command")&&this.refs.icon.setAttribute("value",s);break;case"header-text":this.refs.header.textContent=s,this.classList.add("header-visible");break;case"command":this.refs.command.textContent=s;let e=this.getAttribute("item-id");e&&(this.refs.icon.setAttribute("type","indexed"),this.refs.icon.setAttribute("value",e)),this.classList.add("active")}}}customElements.define("nnoitra-term-item",ft);let vt=window.location.hostname;class wt extends ce{static MOTD_FILE=new URL(Oe);#Ve=null;#gt=1;#yt=null;constructor(e){super(e),this.log.log("Initializing...")}setView(e){this.#Ve=e}get eventHandlers(){return{[k]:this.#L.bind(this),[K]:this.#ft.bind(this),[te]:this.#vt.bind(this),[_]:this.#wt.bind(this)}}async start(){if(this.#Ve&&this.#Ve.welcomeOutputView)try{let e=await $e(wt.MOTD_FILE);console.log(e),this.#Ve.welcomeOutputView.style.whiteSpace="pre-wrap",this.#Ve.welcomeOutputView.textContent=e}catch(e){this.log.error("Failed to load motd.dat:",e)}this.#wt()}#L({key:e,respond:t}){switch(e){case"PS1":t({value:"[{year}-{month}-{day} {hour}:{minute}:{second}] {user}@{host}:{path}"});break;case ye:t({value:vt})}}#bt(e){let t=e.PS1,s=new Date,i={user:e[fe],host:e[ye],path:e.PWD,year:s.getFullYear(),month:String(s.getMonth()+1).padStart(2,"0"),day:String(s.getDate()).padStart(2,"0"),hour:String(s.getHours()).padStart(2,"0"),minute:String(s.getMinutes()).padStart(2,"0"),second:String(s.getSeconds()).padStart(2,"0")};return t.replace(/\{(\w+)\}/g,(e,t)=>i[t]??e)}#St(e){let t=this.#gt++,s=new ft;s.setAttribute("item-id",t),s.setAttribute("header-text",e),this.#Ve.appendToOutput(s),this.#yt=s}async#wt(){try{let[e,t,s,i]=await Promise.all([this.request(f,{key:"PS1"}),this.request(p,{key:fe}),this.request(y,{key:ye}),this.request(y,{key:"PWD"})]),n={PS1:e.value,USER:t.value,HOST:s.value,PWD:i.value},r=this.#bt(n);this.#St(r);let{value:a}=await this.#xt();if(this.#yt){this.#yt.setAttribute("command",a);let e={element:this.#yt};this.log.log(`Executing command: "${a}"`),this.#Ve.scrollToBottom(),this.dispatch(H,{commandString:a,outputElement:e})}}catch(e){this.log.error("Error in command loop:",e),this.dispatch(_)}}#ft(){this.#Ve&&(this.#Ve.clearOutput(),this.#gt=1)}#vt(){this.#Ve&&this.#Ve.scrollToBottom()}#xt(){return this.request(Z,{prompt:"",options:{allowHistory:!0,allowAutocomplete:!0,isSecret:!1}},0)}}class bt extends ce{constructor(e){super(e),this.log.log("Initializing...")}get eventHandlers(){return{[Y]:this.#Ct.bind(this)}}async#Ct({beforeCursorText:e,afterCursorText:t}){this.log.log("Autocomplete request received:",{beforeCursorText:e,afterCursorText:t});let s=Me(e),i=s.pop();s.push("");let n=[],r="",a="",o=0;try{let e=await this.request(W,{parts:s}),{suggestions:t}=e;if(a=e.description,t&&t.length>0){let e=t.filter(e=>e.startsWith(i));r=function(e){if(!e||0===e.length)return"";let t=e[0];for(let s=1;s<e.length;s++)for(;0!==e[s].indexOf(t);)if(""===(t=t.substring(0,t.length-1)))return"";return t}(e),1===t.length&&t[0]===r?n=[]:(n=e,o=i.length)}else a&&(r=i,n=[])}catch(e){this.log.error("Error during autocomplete request:",e)}let l=r.substring(i.length);o+=l.length;let h={newTextBeforeCursor:e+l,options:n,afterCursorText:t,description:a,prefixLength:o};this.log.warn(h),this.dispatch(B,h)}}let St=c("Media"),xt=new CSSStyleSheet;xt.replaceSync("\n  :host {\n    display: block; /* Ensures the host element takes up space */\n  }\n  .media {\n    /* Let the browser calculate width and height to preserve aspect ratio */\n    width: auto;\n    height: auto;\n    /* On larger screens, cap the width at a reasonable size (e.g., 80rem) */\n    /* Use min() to be responsive but also cap the width on large screens. */\n    max-width: min(100%, 80rem);\n    max-height: 80vh;\n    margin: 10px 0;\n    display: block; /* Helps with layout and margin */\n  }\n");class Ct extends mt{#Et;constructor(){super(),this.shadowRoot.adoptedStyleSheets=[...this.shadowRoot.adoptedStyleSheets,xt]}static get observedAttributes(){return["src"]}attributeChangedCallback(e,t,s){"src"===e&&t!==s&&(this.src=s)}set src(e){if(e){if(this.#Et&&this.#Et.remove(),/\.(png|jpg|jpeg|gif|webp)$/i.test(e))this.#Et=document.createElement("img");else{if(!/\.(mp4|webm)$/i.test(e))return void St.error(`Unsupported file type for src: ${e}`);this.#Et=document.createElement("video"),this.#Et.controls=!0}this.#Et.classList.add("media"),this.#Et.src=e,this.shadowRoot.appendChild(this.#Et)}}get src(){return this.getAttribute("src")}}customElements.define("nnoitra-media",Ct);class Et extends ce{constructor(e){super(e),this.log.log("Initializing...")}get eventHandlers(){return{[ne]:this.#At.bind(this)}}#At({src:e,respond:t}){let s=new Ct;s.src=e;let i=new ResizeObserver(e=>{e[0].contentRect.height>1&&(this.dispatch(te),i.disconnect())});i.observe(s),t({mediaElement:s})}}let At="AREFI_LOCAL_ENV";class Tt extends ce{constructor(e){super(e),this.log.log("Initializing...")}get eventHandlers(){return{[A]:this.#Tt.bind(this),[E]:this.#kt.bind(this),"reset-local-variable":this.#It.bind(this),[T]:this.#Mt.bind(this)}}#Pt(e){return e?`${At}_${e.toUpperCase()}`:At}#$t(e){let t=localStorage.getItem(this.#Pt(e));if(!t)return{};try{return JSON.parse(t)}catch(e){return this.log.error("Failed to parse local environment variables from localStorage:",e),{}}}#Ot(e,t){try{localStorage.setItem(this.#Pt(t),JSON.stringify(e))}catch(e){this.log.error("Failed to write to localStorage:",e)}}#Tt({key:e,value:t,respond:s,namespace:i}){if(void 0===e||void 0===t)return this.log.warn("SAVE_LOCAL_VAR requires both a key and a value."),void(s&&s({success:!1}));let n=this.#$t(i);n[e]=t,this.#Ot(n,i),s&&s({success:!0})}#kt({key:e,respond:t,namespace:s}){let i=this.#$t(s),n=void 0!==e?i[e]:i;t&&t({value:n})}#Mt({key:e,respond:t,namespace:s}){if(void 0===e)return this.log.warn("DELETE_LOCAL_VAR requires a key."),void(t&&t({success:!1}));let i=this.#$t(s);delete i[e],this.#Ot(i,s),t&&t({success:!0})}#It({namespace:e}){this.log.log(`Resetting localStorage for namespace: ${e}`),localStorage.removeItem(this.#Pt(e))}}class kt{constructor(e={}){const t=new u;this.services={bus:t,environment:me.create(t),accounting:Ae.create(t,{apiUrl:e.accountingApi}),history:ke.create(t),command:st.create(t),theme:at.create(t),input:ot.create(t),hint:lt.create(t),favicon:ut.create(t),terminal:wt.create(t),filesystem:it.create(t,{apiUrl:e.filesystemApi}),autocomplete:bt.create(t),media:Et.create(t),localStorage:Tt.create(t)}}}let It=new CSSStyleSheet;It.replaceSync("\n[part=footer] {\n  margin: 0;\n  padding: 3px;\n  display: flex;\n  align-items: stretch; /* Change to stretch */\n  border-top: 1px solid var(--nnoitra-color-highlight); /* VAR */\n  background-color: var(--nnoitra-color-background); /* VAR */\n  box-sizing: border-box;\n  z-index: 100;\n  font-size: var(--nnoitra-font-size);\n  height: 2.2em;\n}\n[part=prompt] {\n  background: none;\n  border: none;\n  outline: none;\n  padding: 0;\n  padding-left: 0.5em;\n  padding-right: 0.5em;\n  margin: 0;\n  flex-grow: 1;\n  color: var(--nnoitra-color-theme); /* VAR */\n  min-width: 0; /* Prevents overflow in flex container */\n  flex-grow: 1;\n  font-family: var(--nnoitra-font-family);\n  font-size: var(--nnoitra-font-size);\n  width: 100%;\n}\n[part=prompt]::placeholder {\n  color: var(--nnoitra-color-placeholder);\n  font-family: var(--nnoitra-font-family);\n  font-size: var(--nnoitra-font-size);\n  opacity: 1; /* Firefox has a lower default opacity for placeholders */\n  width: 100%;\n}\n\n[part=icon] {\n  height: 100%;\n  aspect-ratio: 1;\n  margin: 0;\n  padding: 0;\n}\n"),customElements.define("nnoitra-cmd",class extends mt{#je=!1;#qt="";#Nt=!0;#Rt=0;#Dt=0;constructor(){super('\n  <div part="footer">\n  <nnoitra-icon part="icon"></nnoitra-icon>\n  <input type="text" autocomplete="off" spellcheck="false" autocapitalize="off" part="prompt">\n  </div>\n  '),this.shadowRoot.adoptedStyleSheets=[...this.shadowRoot.adoptedStyleSheets,It],this.refs.footer.addEventListener("touchstart",this.#Lt.bind(this),{passive:!0}),this.refs.footer.addEventListener("touchend",this.#Vt.bind(this),{passive:!0}),this.refs.prompt.addEventListener("input",this.#Ut.bind(this)),this.refs.prompt.addEventListener("keydown",this.#Ft.bind(this))}static get observedAttributes(){return["disabled","secret","placeholder","icon-text"]}attributeChangedCallback(e,t,s){switch(e){case"disabled":this.#Nt=!this.hasAttribute("disabled"),this.#Nt&&!this.#je?this.#zt():this.#Nt||this.#jt();break;case"secret":this.#je=this.hasAttribute("secret"),this.#je?this.#Ht():this.#zt();break;case"placeholder":this.refs.prompt.placeholder=s||"";break;case"icon-text":null!==s?(this.refs.icon&&this.refs.icon.setAttribute("type","text"),this.refs.icon&&this.refs.icon.setAttribute("value",s)):this.#je?this.#Ht():this.#zt()}}#Ut(e){if(!this.#je)return;let t=this.refs.prompt,s=this.#qt,i=t.value,n=t.selectionStart,r=s.length-(i.length-(e.data?e.data.length:0)),a=n-(e.data?e.data.length:0),o=s.slice(0,a),l=s.slice(a+r),h=o+(e.data||"")+l;this.#qt=h,requestAnimationFrame(()=>{t.value="●".repeat(this.#qt.length),t.setSelectionRange(n,n)})}#Ft(e){if(!this.#Nt)return e.preventDefault(),void e.stopPropagation();"Enter"===e.key?(e.preventDefault(),this.#_t("enter",{value:this.getValue()})):"Tab"===e.key?(e.preventDefault(),this.#_t("tab")):"ArrowUp"===e.key?(e.preventDefault(),this.#_t("arrow-up")):"ArrowDown"===e.key&&(e.preventDefault(),this.#_t("arrow-down"))}#Lt(e){let t=e.touches[0];t&&(this.#Rt=t.clientX,this.#Dt=t.clientY)}#Vt(e){let t=e.changedTouches[0];if(0===this.#Rt||!t)return;let s=t.clientX-this.#Rt,i=t.clientY-this.#Dt;s>50&&50>Math.abs(i)&&this.#_t("swipe-right")}#_t(e,t={}){this.dispatchEvent(new CustomEvent(e,{bubbles:!0,composed:!0,detail:t}))}focus(){this.refs.prompt.focus()}getValue(){return this.#je?this.#qt:this.refs.prompt.value}setValue(e){this.#je?(this.#qt=e,this.refs.prompt.value="●".repeat(e.length)):this.refs.prompt.value=e}getCursorPosition(){return this.refs.prompt.selectionStart}setCursorPosition(e){this.refs.prompt.setSelectionRange(e,e)}clear(){this.refs.prompt.value="",this.#qt=""}#zt(){this.refs.icon&&this.refs.icon.setAttribute("type","ready")}#jt(){this.refs.icon&&this.refs.icon.setAttribute("type","busy")}#Ht(){this.refs.icon&&this.refs.icon.setAttribute("type","key")}}),c("HintBox");let Mt=new CSSStyleSheet;Mt.replaceSync("\n:host([hidden]) {\n  display: none;\n}\n\n[part=box] {\n  color: var(--nnoitra-color-theme); /* VAR */\n  background-color: var(--nnoitra-color-background); /* VAR */\n  display: flex;\n  flex-direction: row;\n  flex-wrap: wrap;\n  list-style: none;\n  width: 100%;\n  margin: 0;\n  border-left: 3px solid var(--nnoitra-color-highlight);\n  padding: 5px 0 0 10px;\n}\n\n[part=box] li {\n  flex-shrink: 1;\n  margin-right: 1em;\n  margin-bottom: 0.5em;\n  min-width: 0;\n  white-space: normal;\n  overflow-wrap: break-word;\n  opacity: 0;\n  transform: translateY(-5px);\n  transition: opacity 0.2s ease-out, transform 0.2s ease-out;\n}\n\n[part=box] li.visible {\n  opacity: 1;\n  transform: translateY(0);\n}\n\n.prefix {\n  color: var(--nnoitra-color-muted);\n}\n\n.suffix {\n  font-weight: bold;\n}\n"),customElements.define("nnoitra-hint-box",class extends mt{constructor(){super('\n  <ul part="box"></ul>\n  <slot hidden></slot>\n'),this.shadowRoot.adoptedStyleSheets=[...this.shadowRoot.adoptedStyleSheets,Mt],this.shadowRoot.querySelector("slot").addEventListener("slotchange",()=>this.#mt())}static get observedAttributes(){return["hidden","prefix-length"]}attributeChangedCallback(e,t,s){this.#mt()}#mt(){let e=this.refs.box;if(e.innerHTML="",this.hasAttribute("hidden"))return;let t=parseInt(this.getAttribute("prefix-length")||"0",10),s=this.querySelectorAll("li");if(0===s.length)return;let i=document.createDocumentFragment();s.forEach((e,s)=>{let n=e.textContent||"",r=document.createElement("li"),a=document.createElement("span"),o=document.createElement("span");a.className="prefix",a.textContent=n.substring(0,t),o.className="suffix",o.textContent=n.substring(t),r.appendChild(a),r.appendChild(o),i.appendChild(r),setTimeout(()=>r.classList.add("visible"),50*s)}),e.appendChild(i)}});let Pt=c("Terminal"),$t=new URL(e("h1BFt")),Ot=new URL(e("h01Zq")),qt=new URL(e("lAJo3")),Nt=new URL(e("dYGdR")),Rt=new CSSStyleSheet;Rt.replaceSync("\n:host {\n  /* Default Theme & Font Variables */\n  --nnoitra-color-green: #5CB338;\n  --nnoitra-color-yellow: #ECE852;\n  --nnoitra-color-orange: #FFC145;\n  --nnoitra-color-red: #FB4141;\n  --nnoitra-color-black: #000000;\n  --nnoitra-color-white: #FFFFFF;\n  --nnoitra-color-theme: var(--nnoitra-color-green);\n  --nnoitra-color-muted: color-mix(in srgb, var(--nnoitra-color-theme), black 40%);\n  --nnoitra-color-placeholder: var(--nnoitra-color-muted);\n  --nnoitra-color-output: var(--nnoitra-color-white);\n  --nnoitra-color-highlight: var(--nnoitra-color-theme);\n  --nnoitra-color-text-highlight: var(--nnoitra-color-black);\n  --nnoitra-font-family: 'Ubuntu Mono', Menlo, Consolas, 'Liberation Mono', 'Courier New', monospace;\n  --nnoitra-font-size: clamp(0.9rem, 3vw, 1.2rem);\n\n\n  /* Default Layout & Appearance */\n  display: flex;\n  flex-direction: column;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  background-color: var(--nnoitra-color-black);\n  color: var(--nnoitra-color-theme);\n  font-size: var(--nnoitra-font-size);\n  font-family: var(--nnoitra-font-family);\n}\n\n/* Styles for links injected by commands like 'about' */\na {\n    color: var(--nnoitra-color-theme);\n    //text-decoration: none; /* Remove underline for a cleaner look */\n}\n\n/* Styles for 'about' command content */\n.about-title {\n    font-weight: bold;\n}\n\n[part=terminal] {\n  flex: 1;\n  overflow-y: auto;\n  padding: 10px;\n  box-sizing: border-box;\n  display: flex;\n  flex-direction: column;\n  scroll-behavior: smooth;\n  height: 100%;\n  width: 100%;\n}\n[part=prompt] {\n  flex-shrink: 0;\n}\n\n[part=terminal] [part=hint] {\n  padding: 0;\n  margin: 0;\n  margin-top: 6px;\n}\n\n"),customElements.define("nnoitra-terminal",class extends mt{#st;#Yt;#Q;constructor(){super('\n  <div part="terminal">\n  <div part="welcome-output"></div>\n  <div part="output"></div>\n  <nnoitra-hint-box part="hint" hidden></nnoitra-hint-box>\n  </div>\n  <nnoitra-cmd part="prompt"></nnoitra-cmd>\n  '),this.#Bt($t,{weight:"normal"}),this.#Bt(Ot,{weight:"bold"}),this.#Bt(qt,{weight:"normal",style:"italic"}),this.#Bt(Nt,{weight:"bold",style:"italic"}),this.shadowRoot.adoptedStyleSheets=[...this.shadowRoot.adoptedStyleSheets,Rt]}static get observedAttributes(){return["autofocus","filesystem-api","accounting-api"]}get promptView(){return this.refs.prompt}get hintView(){return this.refs.hint}get welcomeOutputView(){return this.refs["welcome-output"]}#Wt(){let e=new kt({filesystemApi:this.getAttribute("filesystem-api"),accountingApi:this.getAttribute("accounting-api")});this.#Q=e.services,this.#Q.input.setView(this.promptView),this.#Q.hint.setView(this.hintView),this.#Q.terminal.setView(this),this.#Q.theme.setView(this),this.#Q.favicon.setView(this),this.#Jt(),Pt.log("Terminal bootstrapped successfully.")}#Bt(e,t={}){let{weight:s="normal",style:i="normal"}=t,n=new FontFace("Ubuntu Mono",`url(${e.href})`,{weight:s,style:i,display:"swap"});n.load().then(()=>{document.fonts.add(n),this.log.log(`Font loaded: Ubuntu Mono ${s} ${i}`)}).catch(e=>{this.log.error(`Failed to load font: Ubuntu Mono ${s} ${i}`,e)})}#Jt(){this.tabIndex=0,this.addEventListener("focus",this.setFocus),this.refs.terminal.addEventListener("click",this.#Xt.bind(this))}connectedCallback(){this.#Wt(),this.#st=new ResizeObserver(()=>{this.scrollToBottom()}),this.#st.observe(this.refs.terminal),this.#Yt=new MutationObserver(()=>this.scrollToBottom()),this.#Yt.observe(this.refs.terminal,{childList:!0,subtree:!0}),Object.values(this.#Q).forEach(e=>{e&&"function"==typeof e.start&&e.start()})}disconnectedCallback(){this.#st&&this.#st.disconnect(),this.#Yt&&this.#Yt.disconnect()}attributeChangedCallback(e){"autofocus"===e&&this.hasAttribute("autofocus")&&this.setFocus()}#Xt(e){e.target===this.refs.terminal&&this.setFocus()}appendToOutput(e){this.refs.output.appendChild(e)}clearOutput(){this.refs.output&&(this.refs.output.innerHTML="")}setFocus(){this.promptView.focus()}scrollToBottom(){requestAnimationFrame(()=>{this.refs.terminal.scrollTop=this.refs.terminal.scrollHeight})}})})();